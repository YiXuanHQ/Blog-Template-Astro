---
title: 存储引擎
nextChapter: "java-backend/mysql/第03章-高级篇/02-索引原理与优化"
parentChapter: "java-backend/mysql/README"
---
# 存储引擎

> 存储引擎是MySQL的核心组件，决定了数据的存储方式和性能特征。本章将深入学习MySQL的存储引擎，掌握存储引擎的选择是优化数据库性能的关键。

## ⚡ 快速参考

- **MySQL体系结构**：连接层、服务层、引擎层、存储层（四层架构）
- **存储引擎**：InnoDB（默认，支持事务、外键、行级锁）、MyISAM（不支持事务，表级锁）、Memory（内存存储）
- **InnoDB特点**：支持事务、外键约束、行级锁、崩溃恢复、MVCC多版本并发控制
- **MyISAM特点**：不支持事务、表级锁、查询速度快、适合读多写少场景
- **引擎选择**：InnoDB（默认，推荐）、MyISAM（只读或读多写少）、Memory（临时表、缓存）
- **查看引擎**：SHOW ENGINES、SHOW TABLE STATUS、CREATE TABLE ... ENGINE=InnoDB

## 📚 学习目标

1. 理解MySQL的四层体系结构及各层的作用
2. 掌握存储引擎的概念和作用，理解不同引擎的特点
3. 深入理解InnoDB和MyISAM的区别及适用场景
4. 掌握如何查看和选择存储引擎
5. 理解存储引擎对数据库性能的影响
6. 能够根据业务需求选择合适的存储引擎
7. 了解Memory等其他存储引擎的特点和使用场景

## 一、MySQL体系结构

### 1.1 MySQL整体架构

MySQL采用**分层架构**，从上到下分为四层：

<img src="https://raw.gitcode.com/YiXuanHQ/YiXuan-Blog-Image/raw/main/tutorials/java-backend/mysql/image-20260111195355527.png" alt="image-20260111195355527" style="zoom: 67%;" />

```
┌─────────────────────────────────────┐
│   连接层 (Connection Layer)         │
│   - 连接处理、授权认证、安全管理     │
└─────────────────────────────────────┘
           ↓
┌─────────────────────────────────────┐
│   服务层 (Service Layer)            │
│   - SQL接口、解析器、优化器、缓存    │
└─────────────────────────────────────┘
           ↓
┌─────────────────────────────────────┐
│   引擎层 (Storage Engine Layer)     │
│   - InnoDB、MyISAM、Memory等        │
└─────────────────────────────────────┘
           ↓
┌─────────────────────────────────────┐
│   存储层 (File System Layer)        │
│   - 数据文件、日志文件等             │
└─────────────────────────────────────┘
```

### 1.2 各层详细说明

**1). 连接层**

最上层是一些客户端和链接服务，包含本地sock通信和大多数基于客户端/服务端工具实现的类似于TCP/IP的通信。主要完成一些类似于连接处理、授权认证、及相关的安全方案。

- ✅ 客户端连接处理
- ✅ 用户认证和授权
- ✅ 连接池管理（在该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程）
- ✅ 基于SSL的安全链接
- ✅ 服务器也会为安全接入的每个客户端验证它所具有的操作权限

**2). 服务层**

第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如过程、函数等。

- ✅ **SQL接口**：接收SQL语句
- ✅ **解析器**：语法分析、语义分析（服务器会解析查询并创建相应的内部解析树）
- ✅ **优化器**：生成执行计划（对其完成相应的优化如确定表的查询的顺序，是否利用索引等，最后生成相应的执行操作）
- ✅ **查询缓存**：如果是select语句，服务器还会查询内部的缓存，如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能（MySQL 8.0已移除）
- ✅ **内置函数**：部分内置函数的执行
- ✅ **跨引擎功能**：过程、函数等

**3). 引擎层**

存储引擎层，存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎。

- ✅ 存储数据
- ✅ 建立索引（数据库中的索引是在存储引擎层实现的）
- ✅ 提供读写接口
- ✅ **可插拔式架构**：插件式的存储引擎架构，将查询处理和其他的系统任务以及数据的存储提取分离

**4). 存储层**

数据存储层，主要是将数据存储在文件系统之上，并完成与存储引擎的交互。

- ✅ 数据文件存储
- ✅ 日志文件管理（如：redolog、undolog、二进制日志、错误日志、查询日志、慢查询日志等）

### 1.3 MySQL架构特点

和其他数据库相比，MySQL有点与众不同，它的架构可以在多种不同场景中应用并发挥良好作用。主要体现在存储引擎上，插件式的存储引擎架构，将查询处理和其他的系统任务以及数据的存储提取分离。这种架构可以根据业务的需求和实际需要选择合适的存储引擎。

---

## 二、存储引擎概述

### 2.1 什么是存储引擎？

![image-20260111195419763](https://raw.gitcode.com/YiXuanHQ/YiXuan-Blog-Image/raw/main/tutorials/java-backend/mysql/image-20260111195419763.png)

大家可能没有听说过存储引擎，但是一定听过引擎这个词，引擎就是发动机，是一个机器的核心组件。比如，对于舰载机、直升机、火箭来说，他们都有各自的引擎，是他们最为核心的组件。而我们在选择引擎的时候，需要在合适的场景，选择合适的存储引擎，就像在直升机上，我们不能选择舰载机的引擎一样。

而对于存储引擎，也是一样，他是MySQL数据库的核心，我们也需要在合适的场景选择合适的存储引擎。

**存储引擎**就是存储数据、建立索引、更新/查询数据等技术的实现方式。

**重要特性：**
- ✅ 存储引擎是**基于表的**，而不是基于库的，所以存储引擎也可被称为表类型
- ✅ 我们可以在创建表的时候，来指定选择的存储引擎，如果没有指定将自动选择默认的存储引擎
- ✅ 同一个数据库中不同表可以使用不同的存储引擎
- ✅ MySQL支持可插拔式存储引擎

### 2.2 查看存储引擎

**1). 查询当前数据库支持的存储引擎**

```sql
SHOW ENGINES;
```

**2). 查询建表语句（查看表的存储引擎）**

```sql
-- 查看表的创建语句，可以看到存储引擎
SHOW CREATE TABLE account;
```

我们可以看到，创建表时，即使我们没有指定存储引擎，数据库也会自动选择默认的存储引擎（InnoDB）。

### 2.3 指定存储引擎

**1). 建表时指定存储引擎**

```sql
CREATE TABLE 表名(
    字段1 字段1类型 [ COMMENT 字段1注释 ] ,
    ......
    字段n 字段n类型 [COMMENT 字段n注释 ]
) ENGINE = INNODB [ COMMENT 表注释 ] ;
```

**示例演示：**

**A. 查询建表语句 --- 默认存储引擎: InnoDB**

```sql
-- 查看表的创建语句
SHOW CREATE TABLE account;
-- 可以看到默认使用的是 InnoDB 引擎
```

![image-20260111195505452](https://raw.gitcode.com/YiXuanHQ/YiXuan-Blog-Image/raw/main/tutorials/java-backend/mysql/image-20260111195505452.png)

**B. 查询当前数据库支持的存储引擎**

```sql
SHOW ENGINES;
```

![image-20260111195526532](https://raw.gitcode.com/YiXuanHQ/YiXuan-Blog-Image/raw/main/tutorials/java-backend/mysql/image-20260111195526532.png)

**C. 创建表 my_myisam，并指定MyISAM存储引擎**

```sql
CREATE TABLE my_myisam(
    id INT,
    name VARCHAR(10)
) ENGINE = MyISAM;
```

**D. 创建表 my_memory，指定Memory存储引擎**

```sql
CREATE TABLE my_memory(
    id INT,
    name VARCHAR(10)
) ENGINE = Memory;
```

**2). 修改表的存储引擎**

```sql
ALTER TABLE my_table ENGINE = MyISAM;
```

---

## 三、InnoDB引擎

### 3.1 InnoDB简介

**1). 介绍**

InnoDB是一种兼顾高可靠性和高性能的通用存储引擎，在 MySQL 5.5 之后，InnoDB是默认的MySQL 存储引擎。

**InnoDB** 是MySQL 5.5及以后版本的**默认存储引擎**，也是最重要的存储引擎。

### 3.2 InnoDB的特点

**2). 特点**

| 特性 | 说明 |
|------|------|
| **事务支持** | ✅ DML操作遵循ACID模型，支持事务 |
| **锁机制** | ✅ 行级锁，提高并发访问性能 |
| **外键约束** | ✅ 支持外键FOREIGN KEY约束，保证数据的完整性和正确性 |
| **崩溃恢复** | ✅ 自动崩溃恢复 |
| **MVCC** | ✅ 多版本并发控制 |
| **索引类型** | B+Tree索引（聚集索引） |

### 3.3 InnoDB文件结构

**3). 文件**

`xxx.ibd`：xxx代表的是表名，innoDB引擎的每张表都会对应这样一个表空间文件，存储该表的表结构（frm-早期的、sdi-新版的）、数据和索引。

**参数：innodb_file_per_table**

```sql
-- 查看是否开启独立表空间
SHOW VARIABLES LIKE 'innodb_file_per_table';
```

![image-20260111195545802](https://raw.gitcode.com/YiXuanHQ/YiXuan-Blog-Image/raw/main/tutorials/java-backend/mysql/image-20260111195545802.png)

如果该参数开启，代表对于InnoDB引擎的表，每一张表都对应一个ibd文件。我们直接打开MySQL的数据存放目录：`C:\ProgramData\MySQL\MySQL Server 8.0\Data`，这个目录下有很多文件夹，不同的文件夹代表不同的数据库。

![image-20260111195630695](https://raw.gitcode.com/YiXuanHQ/YiXuan-Blog-Image/raw/main/tutorials/java-backend/mysql/image-20260111195630695.png)

可以看到里面有很多的ibd文件，每一个ibd文件就对应一张表，比如：我们有一张表 account，就有这样的一个account.ibd文件，而在这个ibd文件中不仅存放表结构、数据，还会存放该表对应的索引信息。而该文件是基于二进制存储的，不能直接基于记事本打开，我们可以使用mysql提供的一个指令 `ibd2sdi`，通过该指令就可以从ibd文件中提取sdi信息，而sdi数据字典信息中就包含该表的表结构。

![image-20260111195646869](https://raw.gitcode.com/YiXuanHQ/YiXuan-Blog-Image/raw/main/tutorials/java-backend/mysql/image-20260111195646869.png)



**文件说明：**
- `表名.ibd`：存储表结构、数据、索引
- `表名.sdi`：表结构定义文件（JSON格式）

### 3.4 InnoDB逻辑存储结构

**4). 逻辑存储结构**

![image-20260111195825014](https://raw.gitcode.com/YiXuanHQ/YiXuan-Blog-Image/raw/main/tutorials/java-backend/mysql/image-20260111195825014.png)

InnoDB存储引擎的逻辑存储结构如下：

```
表空间 (Tablespace)
    ↓
段 (Segment)
    ↓
区 (Extent)
    ↓
页 (Page)
    ↓
行 (Row)
```

**详细说明：**

- **表空间 (Tablespace)**：InnoDB存储引擎逻辑结构的最高层，ibd文件其实就是表空间文件，在表空间中可以包含多个Segment段。

- **段 (Segment)**：表空间是由各个段组成的，常见的段有数据段、索引段、回滚段等。InnoDB中对于段的管理，都是引擎自身完成，不需要人为对其控制，一个段中包含多个区。

- **区 (Extent)**：区是表空间的单元结构，每个区的大小为1M。默认情况下，InnoDB存储引擎页大小为16K，即一个区中一共有64个连续的页。

- **页 (Page)**：页是组成区的最小单元，页也是InnoDB存储引擎磁盘管理的最小单元，每个页的大小默认为16KB。为了保证页的连续性，InnoDB存储引擎每次从磁盘申请4-5个区。

- **行 (Row)**：InnoDB存储引擎是面向行的，也就是说数据是按行进行存放的，在每一行中除了定义表时所指定的字段以外，还包含两个隐藏字段（后面会详细介绍）。

### 3.5 InnoDB架构

**核心组件：**

1. **缓冲池（Buffer Pool）**
   - 缓存数据页和索引页
   - 提高读写性能
   - 默认128MB

2. **日志文件**
   - `redo log`：重做日志，保证持久性
   - `undo log`：回滚日志，保证原子性
   - `binlog`：二进制日志，用于复制和恢复

3. **表空间**
   - 系统表空间：`ibdata1`
   - 独立表空间：`表名.ibd`

### 3.5 InnoDB的优势

**1. 事务支持**
```sql
START TRANSACTION;
UPDATE account SET balance = balance - 100 WHERE id = 1;
UPDATE account SET balance = balance + 100 WHERE id = 2;
COMMIT;  -- 保证原子性
```

**2. 行级锁**
```sql
-- 多个事务可以同时修改不同行
-- 事务A：
UPDATE users SET name = 'A' WHERE id = 1;

-- 事务B：（不会被阻塞）
UPDATE users SET name = 'B' WHERE id = 2;
```

**3. 外键约束**
```sql
CREATE TABLE orders (
    id INT PRIMARY KEY,
    user_id INT,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

**4. 崩溃恢复**
- 使用redo log自动恢复未提交的数据
- 使用undo log回滚未完成的事务

### 3.6 InnoDB适用场景

✅ **推荐使用场景：**
- 需要事务支持（转账、订单）
- 需要外键约束
- 高并发读写
- 频繁的UPDATE/DELETE操作
- 对数据一致性要求高

---

## 四、MyISAM引擎

### 4.1 MyISAM简介

**1). 介绍**

MyISAM是MySQL早期的默认存储引擎。

**MyISAM** 是MySQL 5.5之前的默认存储引擎，现在较少使用。

### 4.2 MyISAM的特点

**2). 特点**

| 特性 | 说明 |
|------|------|
| **事务支持** | ❌ 不支持事务 |
| **锁机制** | ❌ 支持表锁，不支持行锁 |
| **外键约束** | ❌ 不支持外键 |
| **崩溃恢复** | ❌ 无自动恢复 |
| **访问速度** | ✅ 访问速度快 |

### 4.3 MyISAM文件结构

**3). 文件**

每个MyISAM表对应3个文件：

- `xxx.sdi`：存储表结构信息
- `xxx.MYD`：存储数据（MyData）
- `xxx.MYI`：存储索引（MyIndex）

![image-20260111195916218](https://raw.gitcode.com/YiXuanHQ/YiXuan-Blog-Image/raw/main/tutorials/java-backend/mysql/image-20260111195916218.png)

### 4.4 MyISAM vs InnoDB

| 特性 | InnoDB | MyISAM |
|------|--------|--------|
| 事务 | ✅ 支持 | ❌ 不支持 |
| 外键 | ✅ 支持 | ❌ 不支持 |
| 锁 | 行级锁 | 表级锁 |
| 崩溃恢复 | ✅ 自动 | ❌ 需手动 |
| 读性能 | 良好 | 优秀 |
| 写性能 | 优秀 | 一般 |
| 存储空间 | 较大 | 较小 |

### 4.5 MyISAM适用场景

✅ **适用场景：**
- 以SELECT、INSERT为主
- 没有事务需求
- 并发要求不高
- 只读应用或日志系统

❌ **不适用场景：**
- 需要事务
- 高并发写入
- 频繁UPDATE/DELETE

---

## 五、其他存储引擎

### 5.1 Memory引擎

**1). 介绍**

Memory引擎的表数据是存储在内存中的，由于受到硬件问题、或断电问题的影响，只能将这些表作为临时表或缓存使用。

**2). 特点**

- 💾 内存存放
- ⚡ 访问速度快
- ❌ 数据不持久化（重启丢失）
- 🔒 表级锁
- 📊 Hash索引（默认）

**3). 文件**

- `xxx.sdi`：存储表结构信息

**使用场景：**
- 临时表
- 缓存表
- 会话数据
- 中间结果集

**示例：**
```sql
CREATE TABLE cache_table (
    id INT PRIMARY KEY,
    data VARCHAR(100)
) ENGINE = Memory;
```

### 5.2 三种存储引擎对比

**区别及特点：**

| 特点 | InnoDB | MyISAM | Memory |
|------|--------|--------|--------|
| **存储限制** | 64TB | 有 | 有 |
| **事务安全** | ✅ 支持 | ❌ - | ❌ - |
| **锁机制** | 行锁 | 表锁 | 表锁 |
| **B+tree索引** | ✅ 支持 | ✅ 支持 | ✅ 支持 |
| **Hash索引** | ❌ - | ❌ - | ✅ 支持 |
| **全文索引** | ✅ 支持(5.6版本之后) | ✅ 支持 | ❌ - |
| **空间使用** | 高 | 低 | N/A |
| **内存使用** | 高 | 低 | 中等 |
| **批量插入速度** | 低 | 高 | 高 |
| **支持外键** | ✅ 支持 | ❌ - | ❌ - |

**面试题：InnoDB引擎与MyISAM引擎的区别？**

1. **InnoDB引擎，支持事务，而MyISAM不支持。**
2. **InnoDB引擎，支持行锁和表锁，而MyISAM仅支持表锁，不支持行锁。**
3. **InnoDB引擎，支持外键，而MyISAM是不支持的。**

主要是上述三点区别，当然也可以从索引结构、存储限制等方面，更加深入的回答，具体参考如下官方文档：
- https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html
- https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html

### 5.3 CSV引擎

**特点：**
- 📄 数据存储为CSV文件
- 📤 方便数据导入导出
- ❌ 不支持索引

**使用场景：**
- 数据交换
- 日志存储

### 5.4 Archive引擎

**特点：**
- 🗜️ 高度压缩存储
- 📥 只支持INSERT和SELECT
- ❌ 不支持索引

**使用场景：**
- 历史数据归档
- 日志记录

---

## 六、存储引擎的选择

在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。

### 6.1 各引擎适用场景

**InnoDB：**

是Mysql的默认存储引擎，支持事务、外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。

**MyISAM：**

如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。

**MEMORY：**

将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性。

### 6.2 选择决策树

```
需要事务支持？
├─ 是 → InnoDB
└─ 否 ↓

需要外键约束？
├─ 是 → InnoDB
└─ 否 ↓

高并发读写？
├─ 是 → InnoDB
└─ 否 ↓

只读或日志？
├─ 是 → MyISAM 或 Archive
└─ 否 ↓

临时数据？
└─ 是 → Memory
```

### 6.3 各引擎推荐场景

**InnoDB（首选）：**
- ✅ 几乎所有OLTP应用
- ✅ 电商订单系统
- ✅ 金融交易系统
- ✅ 用户管理系统
- ✅ 内容管理系统

**MyISAM：**
- ✅ 只读应用
- ✅ 数据仓库（历史数据）
- ✅ 日志系统
- ✅ 统计分析（低并发）

**Memory：**
- ✅ 会话缓存
- ✅ 临时计算结果
- ✅ 实时统计数据

**Archive：**
- ✅ 历史数据归档
- ✅ 审计日志
- ✅ 只写不改的数据

### 6.4 实际应用建议

**大多数情况：使用InnoDB**

```sql
-- 推荐配置
[mysqld]
default_storage_engine = InnoDB
innodb_file_per_table = ON
innodb_buffer_pool_size = 1G  -- 根据内存调整
```

**混合使用：**
```sql
-- 核心业务表：InnoDB
CREATE TABLE orders (...) ENGINE=InnoDB;
CREATE TABLE users (...) ENGINE=InnoDB;

-- 日志表：MyISAM（或Archive）
CREATE TABLE access_log (...) ENGINE=MyISAM;

-- 临时表：Memory
CREATE TEMPORARY TABLE temp_result (...) ENGINE=Memory;
```

---

## 七、本章总结

### 核心要点

1. **MySQL架构**：连接层→服务层→引擎层→存储层
2. **InnoDB**：默认引擎，支持事务、外键、行锁
3. **MyISAM**：不支持事务，表锁，读性能好
4. **Memory**：内存存储，速度快，数据不持久
5. **存储引擎可插拔**：不同表可用不同引擎

### 选择建议

| 场景 | 推荐引擎 | 理由 |
|------|---------|------|
| 大多数应用 | InnoDB | 事务、并发、可靠性 |
| 只读应用 | MyISAM | 读性能好 |
| 临时数据 | Memory | 速度快 |
| 归档数据 | Archive | 高压缩比 |

### 最佳实践

1. ✅ **优先使用InnoDB**（除非有特殊需求）
2. ✅ **开启独立表空间**（innodb_file_per_table=ON）
3. ✅ **合理配置缓冲池**（innodb_buffer_pool_size）
4. ✅ **避免混用引擎**（同一业务用同一引擎）
5. ✅ **定期备份**（尤其是MyISAM）

---

## 练习题

```sql
-- 1. 查看当前数据库支持的存储引擎
SHOW ENGINES;

-- 2. 查看表的存储引擎
SHOW TABLE STATUS LIKE 'table_name';

-- 3. 创建不同引擎的表
CREATE TABLE innodb_table (...) ENGINE=InnoDB;
CREATE TABLE myisam_table (...) ENGINE=MyISAM;
CREATE TABLE memory_table (...) ENGINE=Memory;

-- 4. 修改表的存储引擎
ALTER TABLE myisam_table ENGINE=InnoDB;

-- 5. 比较不同引擎的性能差异（自行测试）
```

---

**上一章：** [事务管理](/tutorials/java-backend/mysql/第02章-进阶篇/04-事务管理/)

**下一章：** [索引原理与优化](/tutorials/java-backend/mysql/第03章-高级篇/02-索引原理与优化/) →
