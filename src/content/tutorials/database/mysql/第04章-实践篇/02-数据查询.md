---
title: 数据查询
prevChapter: "java-backend/mysql/第04章-实践篇/01-数据库和表的管理"
nextChapter: "java-backend/mysql/第04章-实践篇/03-索引和视图"
parentChapter: "java-backend/mysql/README"
---
# 数据查询

> 本章通过实际案例学习MySQL的各种查询操作，包括基本查询、条件查询、分组查询、连接查询、子查询等。掌握SQL查询语句的编写技巧和优化方法。

## ⚡ 快速参考

- **基本查询**：SELECT、FROM、WHERE、ORDER BY、LIMIT
- **条件查询**：比较运算符、逻辑运算符、模糊查询（LIKE）、范围查询（IN、BETWEEN）
- **聚合函数**：COUNT、SUM、AVG、MAX、MIN
- **分组查询**：GROUP BY、HAVING
- **连接查询**：INNER JOIN、LEFT JOIN、RIGHT JOIN
- **子查询**：标量子查询、列子查询、行子查询、表子查询
- **集合运算**：UNION、UNION ALL

## 📚 学习目标

1. 掌握基本SELECT查询语句的编写
2. 熟练使用WHERE子句进行条件查询
3. 掌握ORDER BY进行排序查询
4. 理解GROUP BY分组查询和HAVING过滤
5. 掌握聚合函数的使用方法
6. 熟练使用连接查询获取多表数据
7. 掌握各种类型的子查询
8. 理解UNION集合运算的用法

## 实践目标

通过本实践，你将学会：
- ✅ 基本SELECT查询
- ✅ 条件查询（WHERE子句）
- ✅ 排序查询（ORDER BY）
- ✅ 分组查询（GROUP BY）
- ✅ 聚合函数的使用
- ✅ 连接查询（内连接、外连接）
- ✅ 子查询（嵌套查询）
- ✅ 集合运算（UNION）

## 实践环境

**数据库：** studentsdb

**数据表：**
- `student_info`：学生信息表
- `curriculum`：课程表
- `grade`：成绩表

## 实践步骤

### 1. 基本查询

#### 1.1 查询指定列

在 `student_info` 表中，查询每个学生的学号、姓名、出生日期信息。

```sql
USE studentsdb;

SELECT 学号, 姓名, 出生日期 
FROM student_info;
```

#### 1.2 条件查询

查询 `student_info` 表学号为 `0002` 的学生的姓名和家族住址。

```sql
SELECT 姓名, 家族住址 
FROM student_info 
WHERE 学号 = '0002';
```

#### 1.3 多条件查询

查询 `student_info` 表所有出生日期在95年以后的女同学的姓名和出生日期。

```sql
SELECT 姓名, 出生日期 
FROM student_info
WHERE 出生日期 >= '1996-01-01' AND 性别 = '女';
```

### 2. 条件查询进阶

#### 2.1 范围查询

在 `grade` 表中查询分数在70-80范围内的学生的学号、课程编号和成绩。

```sql
SELECT 学号, 课程编号, 分数 
FROM grade 
WHERE 分数 BETWEEN 70 AND 80;
```

#### 2.2 聚合函数查询

在 `grade` 表中查询课程编号为 `0002` 的学生的平均成绩。

```sql
SELECT AVG(分数) AS 平均分 
FROM grade 
WHERE 课程编号 = '0002';
```

#### 2.3 计数查询

在 `grade` 表中查询选修课程编号为 `0003` 的人数和该课程有成绩的人数。

```sql
SELECT 
    COUNT(*) AS 选课人数,
    COUNT(分数) AS 有成绩人数 
FROM grade
WHERE 课程编号 = '0003';
```

#### 2.4 排序查询

查询 `student_info` 的姓名和出生日期，查询结果按出生日期从大到小排序。

```sql
SELECT 姓名, 出生日期 
FROM student_info 
ORDER BY 出生日期 DESC;
```

#### 2.5 模糊查询

查询所有姓名"张"开头的学生的学号和姓名。

```sql
SELECT 学号, 姓名 
FROM student_info 
WHERE 姓名 LIKE '张%';
```

### 3. 多字段排序

对 `student_info` 表，查询学生的学号、姓名、性别、出生日期及家族住址，查询结果先按照性别的由小到大排序，性别相同的再按学号由大到小排序。

```sql
SELECT 学号, 姓名, 性别, 出生日期, 家族住址 
FROM student_info
ORDER BY 性别 ASC, 学号 DESC;
```

### 4. 分组查询

使用 `GROUP BY` 子句查询 `grade` 表中各个学生的平均成绩。

```sql
SELECT 学号, AVG(分数) AS 平均成绩 
FROM grade 
GROUP BY 学号;
```

### 5. 集合运算

使用 `UNION` 运算符将 `student_info` 表中姓"刘"的学生的学号、姓名与姓"张"的学生的学号、姓名返回在一个表中。

```sql
SELECT 学号, 姓名 
FROM student_info 
WHERE 姓名 LIKE '刘%'
UNION
SELECT 学号, 姓名 
FROM student_info 
WHERE 姓名 LIKE '张%';
```

### 6. 嵌套查询（子查询）

#### 6.1 等值子查询

在 `student_info` 表中查找与"刘东阳"性别相同的所有学生的姓名、出生日期。

```sql
SELECT 姓名, 出生日期 
FROM student_info
WHERE 性别 = (
    SELECT 性别 
    FROM student_info 
    WHERE 姓名 = '刘东阳'
);
```

#### 6.2 IN子查询

使用 `IN` 子查询查找所修课程编号为 `0002`、`0005` 的学生学号、姓名、性别。

```sql
SELECT 学号, 姓名, 性别 
FROM student_info
WHERE 学号 IN (
    SELECT 学号 
    FROM grade
    WHERE 课程编号 IN ('0002', '0005')
);
```

#### 6.3 ANY子查询

使用 `ANY` 子查询查找学号为 `0001` 的学生的分数比 `0002` 号的学生的最低分数高的课程编号和分数。

```sql
SELECT 课程编号, 分数 
FROM grade
WHERE 学号 = '0001' 
  AND 分数 > ANY (
      SELECT 分数 
      FROM grade
      WHERE 学号 = '0002'
  );
```

#### 6.4 ALL子查询

使用 `ALL` 子查询查找学号为 `0001` 的学生的分数比学号为 `0002` 的学生的最高成绩还要高的课程编号和分数。

```sql
SELECT 课程编号, 分数 
FROM grade
WHERE 学号 = '0001' 
  AND 分数 > ALL (
      SELECT 分数 
      FROM grade
      WHERE 学号 = '0002'
  );
```

### 7. 连接查询

#### 7.1 内连接（等值连接）

查询分数在80-90范围内的学生的学号、姓名、分数。

```sql
SELECT s.学号, 姓名, 分数 
FROM student_info s, grade g
WHERE s.学号 = g.学号 
  AND 分数 BETWEEN 80 AND 90;
```

#### 7.2 内连接（INNER JOIN）

使用 `INNER JOIN` 连接方式查询学习"数据库原理及应用"课程的学生学号、姓名、分数。

```sql
SELECT s.学号, 姓名, 分数 
FROM student_info s 
INNER JOIN grade g ON s.学号 = g.学号 
INNER JOIN curriculum c ON g.课程编号 = c.课程编号
WHERE 课程名称 = '数据库原理及应用';
```

#### 7.3 分组聚合查询

查询每个学生所选课程的最高成绩，要求列出学号、姓名、最高成绩。

```sql
SELECT s.学号, 姓名, MAX(分数) AS 最高成绩
FROM student_info s, grade g
WHERE s.学号 = g.学号
GROUP BY s.学号;
```

#### 7.4 左外连接

使用左外连接查询每个学生的总成绩，要求列出学号、姓名、总成绩，没有选修课程的学生的总成绩为空。

```sql
SELECT s.学号, 姓名, SUM(分数) AS 总成绩
FROM student_info s 
LEFT OUTER JOIN grade g ON s.学号 = g.学号
GROUP BY s.学号;
```

#### 7.5 右外连接

为 `grade` 表添加数据行：学号为 `0004`、课程编号为 `0006`、分数为76。使用右外连接查询所有课程的选修情况，要求列出课程编号、课程名称、选修人数，`curriculum` 表中没有的课程列值为空。

```sql
-- 先插入测试数据
INSERT INTO grade VALUES('0004', '0006', 76);

-- 右外连接查询
SELECT g.课程编号, 课程名称, COUNT(*) AS 选修人数
FROM curriculum c 
RIGHT OUTER JOIN grade g ON g.课程编号 = c.课程编号
GROUP BY g.课程编号;
```

## 实践总结

### 关键知识点

1. **基本查询**
   - `SELECT`：选择列
   - `FROM`：指定表
   - `WHERE`：条件过滤

2. **条件查询**
   - `=`、`!=`、`<>`：等值比较
   - `>`、`<`、`>=`、`<=`：比较运算符
   - `BETWEEN ... AND`：范围查询
   - `LIKE`：模糊查询
   - `IN`：集合查询

3. **聚合函数**
   - `COUNT()`：计数
   - `SUM()`：求和
   - `AVG()`：平均值
   - `MAX()`：最大值
   - `MIN()`：最小值

4. **分组和排序**
   - `GROUP BY`：分组
   - `ORDER BY`：排序
   - `ASC`：升序
   - `DESC`：降序

5. **连接查询**
   - 内连接：`INNER JOIN` 或 `,`（逗号）
   - 左外连接：`LEFT OUTER JOIN`
   - 右外连接：`RIGHT OUTER JOIN`

6. **子查询**
   - 等值子查询：`=`
   - IN子查询：`IN`
   - ANY子查询：`> ANY`
   - ALL子查询：`> ALL`

### 注意事项

- ⚠️ 使用聚合函数时，非聚合列必须出现在 `GROUP BY` 中
- ⚠️ `WHERE` 子句不能使用聚合函数，应使用 `HAVING`
- ✅ 连接查询时注意表别名，避免列名歧义
- ✅ 子查询可以嵌套多层，但要注意性能
- ✅ 外连接可以查询到主表中没有匹配的记录

---

## 练习题

1. 查询所有男学生的学号和姓名
2. 查询平均分大于80分的学生的学号和平均分
3. 查询选修了"高等数学"课程的所有学生的姓名和分数
4. 查询没有选修任何课程的学生信息
5. 查询每个课程的平均分，并按平均分降序排列

---

**上一章：** [数据库和表的管理](/tutorials/java-backend/mysql/第04章-实践篇/01-数据库和表的管理/)

**下一章：** [索引和视图](/tutorials/java-backend/mysql/第04章-实践篇/03-索引和视图/) →
