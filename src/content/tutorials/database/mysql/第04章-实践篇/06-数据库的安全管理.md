---
title: 数据库的安全管理
prevChapter: "java-backend/mysql/第04章-实践篇/05-存储过程和存储函数"
nextChapter: "java-backend/mysql/第04章-实践篇/07-数据库的备份与恢复"
parentChapter: "java-backend/mysql/README"
---
# 数据库的安全管理

> 本章通过实际案例学习MySQL数据库的安全管理，包括用户账号的创建和管理、权限的授予和撤销、角色的创建和使用。掌握如何通过权限控制保证数据库安全。

## ⚡ 快速参考

- **用户管理**：CREATE USER、ALTER USER、DROP USER、RENAME USER
- **权限管理**：GRANT、REVOKE、SHOW GRANTS
- **角色管理**：CREATE ROLE、DROP ROLE、GRANT ROLE、REVOKE ROLE
- **权限级别**：全局权限、数据库权限、表权限、列权限
- **密码管理**：ALTER USER ... IDENTIFIED BY、SET PASSWORD
- **安全原则**：最小权限原则、定期审查权限、使用角色管理

## 📚 学习目标

1. 掌握用户账号的创建、修改和删除操作
2. 理解权限的概念和分类（全局、数据库、表、列权限）
3. 掌握权限的授予和撤销方法
4. 理解角色的创建和使用
5. 掌握为用户分配角色的方法
6. 理解数据库安全管理的原则和最佳实践
7. 能够根据业务需求设计合理的权限控制策略

## 实践目标

通过本实践，你将学会：
- ✅ 创建和管理用户账号
- ✅ 授予和撤销用户权限
- ✅ 创建和管理角色
- ✅ 为用户分配角色
- ✅ 修改用户密码
- ✅ 删除用户和角色

## 实践环境

**数据库：** studentsdb

**数据表：**
- `student_info`：学生信息表

## 实践步骤

### 一、用户账号管理

#### 1. 创建用户账号

在本地主机创建用户账号 `st_01`，密码为 `123456`。

```sql
CREATE USER st_01@localhost IDENTIFIED BY '123456';
```

#### 2. 查看用户账号

查看MySQL下所有用户账号列表。

```sql
USE mysql;
SELECT * FROM USER;

-- 或者使用以下命令查看
SELECT User, Host FROM mysql.user;
```

#### 3. 修改用户密码

修改用户账号 `st_01` 的密码为 `111111`。

```sql
-- 方式1：使用SET PASSWORD（MySQL 5.7及之前）
SET PASSWORD FOR st_01@localhost = PASSWORD('111111');

-- 方式2：使用ALTER USER（MySQL 5.7+推荐）
ALTER USER st_01@localhost IDENTIFIED BY '111111';
```

### 二、权限管理

#### 4. 授予表级权限

使用 `studentsdb` 数据库中的 `student_info` 表。

**（1）授予用户账号 `st_01` 查询表的权限。**

```sql
GRANT SELECT ON TABLE studentsdb.student_info TO st_01@localhost;
```

**（2）授予用户账号 `st_01` 更新家族住址列的权限。**

```sql
GRANT UPDATE(家族住址) ON TABLE studentsdb.student_info TO st_01@localhost;
```

**（3）授予用户账号 `st_01` 修改表结构的权限。**

```sql
GRANT ALTER ON TABLE studentsdb.student_info TO st_01@localhost;
```

#### 5. 授予存储过程权限

使用 `studentsdb` 数据库中的 `student_info` 表。

**（1）创建存储过程 `cn_proc`，统计 `student_info` 表中的学生人数。**

```sql
DELIMITER @@
CREATE PROCEDURE studentsdb.cn_proc()
BEGIN
    DECLARE n INT;
    SELECT COUNT(*) INTO n FROM studentsdb.student_info;
    SELECT n;
END @@
DELIMITER ;
```

**（2）授予用户账号 `st_01` 调用 `cn_proc` 存储过程的权限。**

```sql
GRANT EXECUTE ON PROCEDURE studentsdb.cn_proc TO st_01@localhost;
```

**（3）以用户账号 `st_01` 连接MySQL服务器，调用 `cn_proc` 存储过程查看学生人数。**

```sql
-- 使用st_01用户登录后执行
CALL studentsdb.cn_proc();
```

#### 6. 授予数据库级权限

使用 `studentsdb` 数据库。

**（1）授予用户账号 `st_01` 在 `studentsdb` 数据库上创建表、删除表、查询数据、插入数据的权限。**

```sql
GRANT CREATE, SELECT, INSERT, DROP ON studentsdb.* TO st_01@localhost;

-- 刷新权限
FLUSH PRIVILEGES;
```

**（2）以用户账号 `st_01` 连接MySQL服务器，创建新表 `st_copy`，与表 `student_info` 完全相同。**

```sql
-- 使用st_01用户登录后执行
CREATE TABLE studentsdb.st_copy 
AS SELECT * FROM studentsdb.student_info;
```

**（3）以用户账号 `st_01` 连接MySQL服务器，删除表 `st_copy`。**

```sql
-- 使用st_01用户登录后执行
DROP TABLE studentsdb.st_copy;
```

#### 7. 撤销权限

**撤销用户账号 `st_01` 在 `studentsdb` 数据库上创建表、删除表、查询数据、插入数据的权限。**

```sql
REVOKE CREATE, SELECT, INSERT, DROP ON studentsdb.* FROM st_01@localhost;

-- 刷新权限
FLUSH PRIVILEGES;
```

#### 8. 撤销所有权限

撤销用户账号 `st_01` 所有权限。

```sql
REVOKE ALL PRIVILEGES, GRANT OPTION FROM st_01@localhost;

-- 刷新权限
FLUSH PRIVILEGES;
```

### 三、角色管理

#### 9. 创建和使用角色

使用 `studentsdb` 数据库中的 `student_info` 表。

**（1）创建本地机角色 `student`。**

```sql
CREATE ROLE 'student'@'localhost';
```

**（2）授予角色 `student` 查询 `student_info` 表的权限。**

```sql
GRANT SELECT ON TABLE studentsdb.student_info TO 'student'@'localhost';
```

**（3）创建本地机用户账号 `st_02`，密码为 `123`。**

```sql
CREATE USER st_02@localhost IDENTIFIED BY '123';
```

**（4）授予用户账号 `st_02` 角色 `student` 的权限。**

```sql
GRANT 'student'@'localhost' TO st_02@localhost;

-- 设置自动激活角色（MySQL 8.0+）
SET GLOBAL activate_all_roles_on_login = ON;

-- 或者手动激活角色
SET ROLE 'student'@'localhost';
```

**（5）以用户账号 `st_02` 连接MySQL服务器，查看 `student_info` 表信息。**

```sql
-- 使用st_02用户登录后执行
SELECT * FROM studentsdb.student_info;
```

**（6）撤销用户账号 `st_02` 角色 `student` 的权限。**

```sql
REVOKE 'student'@'localhost' FROM st_02@localhost;
```

**（7）删除角色 `student`。**

```sql
DROP ROLE 'student'@'localhost';
```

### 四、清理工作

#### 10. 删除用户账号

删除用户账号 `st_01`、`st_02`。

```sql
DROP USER st_01@localhost, st_02@localhost;
```

## 实践总结

### 关键知识点

#### 权限类型

1. **表级权限**
   - `SELECT`：查询权限
   - `INSERT`：插入权限
   - `UPDATE`：更新权限
   - `DELETE`：删除权限
   - `ALTER`：修改表结构权限
   - `INDEX`：创建索引权限

2. **列级权限**
   - `UPDATE(列名)`：更新指定列的权限
   - `SELECT(列名)`：查询指定列的权限

3. **数据库级权限**
   - `CREATE`：创建表权限
   - `DROP`：删除表权限
   - `ALTER`：修改表权限
   - `SELECT`：查询权限
   - `INSERT`：插入权限
   - `UPDATE`：更新权限
   - `DELETE`：删除权限

4. **存储过程权限**
   - `EXECUTE`：执行存储过程权限

#### 角色管理

- **角色**：权限的集合，可以分配给多个用户
- **用户**：具体的账号，可以拥有多个角色
- **优势**：简化权限管理，提高可维护性

### 注意事项

- ⚠️ 权限修改后需要执行 `FLUSH PRIVILEGES` 刷新权限
- ⚠️ 角色功能在MySQL 8.0+才完全支持
- ⚠️ 删除用户前确保没有重要数据依赖
- ✅ 遵循最小权限原则
- ✅ 定期审查用户权限
- ✅ 使用角色简化权限管理

### 最佳实践

1. **权限管理**
   - 遵循最小权限原则
   - 定期审查和清理无用账号
   - 使用角色统一管理权限

2. **密码安全**
   - 使用强密码策略
   - 定期更换密码
   - 避免使用默认密码

3. **账号管理**
   - 为不同角色创建不同账号
   - 及时删除无用账号
   - 记录权限变更日志

---

## 练习题

1. 创建一个用户 `test_user`，授予其对 `studentsdb` 数据库的只读权限
2. 创建一个角色 `readonly_role`，授予查询权限，并分配给多个用户
3. 测试用户权限，验证权限是否正确授予
4. 撤销所有权限并删除用户和角色

---

**上一章：** [存储过程和存储函数](/tutorials/java-backend/mysql/第04章-实践篇/05-存储过程和存储函数/)

**下一章：** [数据库的备份与恢复](/tutorials/java-backend/mysql/第04章-实践篇/07-数据库的备份与恢复/) →
