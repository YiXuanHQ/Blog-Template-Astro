---
title: 索引和视图
prevChapter: "java-backend/mysql/第04章-实践篇/02-数据查询"
nextChapter: "java-backend/mysql/第04章-实践篇/04-数据完整性"
parentChapter: "java-backend/mysql/README"
---
# 索引和视图

> 本章通过实际案例学习MySQL索引和视图的创建、管理和使用。索引可以提升查询性能，视图可以简化复杂查询并保护数据安全。

## ⚡ 快速参考

- **索引类型**：主键索引、唯一索引、普通索引、复合索引
- **索引操作**：CREATE INDEX、ALTER TABLE ... ADD INDEX、DROP INDEX、SHOW INDEX
- **视图操作**：CREATE VIEW、ALTER VIEW、DROP VIEW、SHOW CREATE VIEW
- **视图特点**：虚拟表、动态生成、简化查询、数据安全
- **索引优势**：提高查询速度、加速排序、支持唯一性约束
- **视图优势**：简化复杂查询、提高代码复用、隐藏敏感数据

## 📚 学习目标

1. 掌握各种类型索引的创建和删除方法
2. 理解索引对查询性能的提升作用
3. 掌握视图的创建、修改和删除操作
4. 理解视图与表的区别和联系
5. 掌握通过视图进行数据查询和更新的方法
6. 理解索引和视图在实际项目中的应用场景
7. 能够根据业务需求合理设计索引和视图

## 实践目标

通过本实践，你将学会：
- ✅ 创建和删除索引（主键索引、唯一索引、普通索引、复合索引）
- ✅ 查看索引信息
- ✅ 创建和管理视图
- ✅ 通过视图查询、插入、更新、删除数据
- ✅ 修改和删除视图

## 实践环境

**数据库：** studentsdb

**数据表：**
- `student_info`：学生信息表
- `curriculum`：课程表
- `grade`：成绩表

## 实践步骤

### 一、索引管理

#### 1. 删除主键索引

使用SQL语句 `ALTER TABLE` 分别删除 `studentsdb` 数据库的 `student_info` 表、`grade` 表、`curriculum` 表的主键索引。

```sql
USE studentsdb;

ALTER TABLE student_info DROP PRIMARY KEY;
ALTER TABLE curriculum DROP PRIMARY KEY;
ALTER TABLE grade DROP PRIMARY KEY;
```

#### 2. 创建唯一索引

使用SQL语句为 `curriculum` 表的课程编号创建唯一性索引，命名为 `cno_idx`。

```sql
CREATE UNIQUE INDEX cno_idx ON curriculum(课程编号);
```

#### 3. 创建普通索引

使用SQL语句为 `grade` 表的"分数"字段创建一个普通索引，命名为 `grade_idx`。

```sql
CREATE INDEX grade_idx ON grade(分数);
```

#### 4. 创建复合索引

使用SQL语句为 `grade` 表的"学号"和"课程编号"字段创建一个复合唯一索引，命名为 `grade_sid_cid_idx`。

```sql
CREATE UNIQUE INDEX grade_sid_cid_idx ON grade(学号, 课程编号);
```

**注意：** 复合索引的顺序很重要，查询时遵循最左前缀原则。

#### 5. 查看索引信息

查看 `grade` 表上的索引信息。

```sql
SHOW INDEX FROM grade;
```

#### 6. 删除索引

使用SQL语句删除索引 `grade_idx`。再次查看 `grade` 表上的索引信息。

```sql
DROP INDEX grade_idx ON grade;

-- 再次查看索引信息
SHOW INDEX FROM grade;
```

### 二、视图管理

#### 7. 创建简单视图

使用SQL语句 `CREATE VIEW` 建立一个名为 `v_stu_c` 的视图，显示学生的学号、姓名、所学课程的课程编号，并利用视图查询学号为 `0003` 的学生情况。

```sql
CREATE VIEW v_stu_c
AS
SELECT s.学号, 姓名, 课程编号 
FROM student_info s, grade g
WHERE s.学号 = g.学号;

-- 使用视图查询
SELECT * FROM v_stu_c
WHERE 学号 = '0003';
```

#### 8. 创建多表连接视图

基于 `student_info` 表、`curriculum` 表和 `grade` 表，建立一个名为 `v_stu_g` 的视图，视图包括所有学生的学号、姓名、课程名称、分数。使用视图 `v_stu_g` 查询学号为 `0001` 的学生的课程平均分。

```sql
CREATE VIEW v_stu_g
AS
SELECT s.学号, 姓名, 课程名称, 分数
FROM student_info s, grade g, curriculum c
WHERE s.学号 = g.学号 AND g.课程编号 = c.课程编号;

-- 使用视图查询平均分
SELECT AVG(分数) AS 平均分 
FROM v_stu_g 
WHERE 学号 = '0001';
```

#### 9. 修改视图

使用SQL语句修改视图 `v_stu_g`，显示学生的学号、姓名、性别。

```sql
ALTER VIEW v_stu_g
AS
SELECT 学号, 姓名, 性别 
FROM student_info;

-- 查看修改后的视图
SELECT * FROM v_stu_g;
```

#### 10. 通过视图插入数据

利用视图 `v_stu_g` 为 `student_info` 表添加一行数据：学号为 `0010`、姓名为陈婷婷、性别为女。

```sql
INSERT INTO v_stu_g (学号, 姓名, 性别)
VALUES ('0010', '陈婷婷', '女');

-- 验证插入结果
SELECT * FROM student_info WHERE 学号 = '0010';
```

**注意：** 通过视图插入数据时，视图必须基于单表，且不能包含聚合函数、GROUP BY等。

#### 11. 通过视图删除数据

利用视图 `v_stu_g` 删除学号为 `0010` 的学生记录。

```sql
DELETE FROM v_stu_g 
WHERE 学号 = '0010';

-- 验证删除结果
SELECT * FROM student_info WHERE 学号 = '0010';
```

#### 12. 通过视图更新数据

利用视图 `v_stu_g` 修改姓名为"张青平"的学生的高等数学的分数为87。

**注意：** 由于视图 `v_stu_g` 已经修改为只包含学号、姓名、性别，无法直接更新成绩。需要通过原表更新。

```sql
UPDATE grade 
SET 分数 = 87
WHERE 学号 = (
    SELECT 学号 
    FROM v_stu_g 
    WHERE 姓名 = '张青平'
) AND 课程编号 = (
    SELECT 课程编号 
    FROM curriculum 
    WHERE 课程名称 = '高等数学'
);

-- 验证更新结果
SELECT * FROM grade 
WHERE 学号 = (
    SELECT 学号 
    FROM student_info 
    WHERE 姓名 = '张青平'
) AND 课程编号 = (
    SELECT 课程编号 
    FROM curriculum 
    WHERE 课程名称 = '高等数学'
);
```

#### 13. 删除视图

使用SQL语句删除视图 `v_stu_c` 和 `v_stu_g`。

```sql
DROP VIEW v_stu_c, v_stu_g;
```

## 实践总结

### 关键知识点

#### 索引类型

1. **主键索引（PRIMARY KEY）**
   - 唯一且非空
   - 每个表只能有一个主键
   - 自动创建

2. **唯一索引（UNIQUE INDEX）**
   - 保证列值唯一
   - 可以有多个唯一索引
   - 允许NULL值

3. **普通索引（INDEX）**
   - 提升查询性能
   - 允许重复值
   - 可以有多个

4. **复合索引**
   - 基于多个列
   - 遵循最左前缀原则
   - 顺序很重要

#### 视图特点

1. **视图的作用**
   - 简化复杂查询
   - 保护数据安全
   - 隐藏表结构
   - 提供数据抽象

2. **视图的限制**
   - 通过视图插入/更新/删除数据有限制
   - 视图必须基于单表才能进行DML操作
   - 包含聚合函数、GROUP BY等的视图不能进行DML操作

### 注意事项

- ⚠️ 删除主键索引前，确保没有外键引用
- ⚠️ 创建索引会占用存储空间，影响插入/更新性能
- ⚠️ 复合索引的顺序很重要，遵循最左前缀原则
- ✅ 索引可以显著提升查询性能
- ✅ 视图可以简化复杂查询，提高代码可维护性
- ✅ 通过视图操作数据时，实际操作的是基表

### 性能优化建议

1. **索引优化**
   - 在经常用于WHERE、JOIN、ORDER BY的列上创建索引
   - 避免在小表上创建过多索引
   - 定期分析索引使用情况

2. **视图优化**
   - 视图查询会转换为对基表的查询
   - 复杂视图可能影响性能
   - 考虑使用物化视图（MySQL 8.0+）

---

## 练习题

1. 为 `student_info` 表的"姓名"字段创建唯一索引
2. 创建一个视图，显示每个学生的学号、姓名和总成绩
3. 通过视图查询平均分大于80分的学生信息
4. 删除创建的索引和视图

---

**上一章：** [数据查询](/tutorials/java-backend/mysql/第04章-实践篇/02-数据查询/)

**下一章：** [数据完整性](/tutorials/java-backend/mysql/第04章-实践篇/04-数据完整性/) →
