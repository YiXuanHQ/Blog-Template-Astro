---
title: ç›¸æœºå¼€å‘
date: 2025-01-22
prevChapter: "harmonyos-dev/12-multimedia-next/02-è§†é¢‘æ’­æ”¾ä¸å¤„ç†"
parentChapter: "harmonyos-dev/12-multimedia-next/README"
---
# ç›¸æœºå¼€å‘

> å®ç°ç›¸æœºåŠŸèƒ½

## ğŸ“· ç›¸æœºé¢„è§ˆ

```typescript
import { camera } from '@kit.CameraKit'

@Entry
@Component
struct CameraDemo {
  private xComponentController: XComponentController = new XComponentController()
  @State surfaceId: string = ''
  private cameraManager: camera.CameraManager | undefined
  private session: camera.PhotoSession | undefined
  
  async startCamera() {
    try {
      // è·å–ç›¸æœºç®¡ç†å™¨
      this.cameraManager = camera.getCameraManager(getContext())
      
      // è·å–ç›¸æœºåˆ—è¡¨
      const cameras = this.cameraManager.getSupportedCameras()
      const backCamera = cameras.find(cam => 
        cam.cameraPosition === camera.CameraPosition.CAMERA_POSITION_BACK
      )
      
      if (!backCamera) return
      
      // åˆ›å»ºç›¸æœºè¾“å…¥
      const cameraInput = this.cameraManager.createCameraInput(backCamera)
      await cameraInput.open()
      
      // åˆ›å»ºé¢„è§ˆè¾“å‡º
      const previewProfile = {
        format: camera.CameraFormat.CAMERA_FORMAT_YUV_420_SP,
        size: { width: 1920, height: 1080 }
      }
      const previewOutput = this.cameraManager.createPreviewOutput(
        previewProfile,
        this.surfaceId
      )
      
      // åˆ›å»ºä¼šè¯
      this.session = this.cameraManager.createPhotoSession()
      this.session.beginConfig()
      this.session.addInput(cameraInput)
      this.session.addOutput(previewOutput)
      await this.session.commitConfig()
      await this.session.start()
      
    } catch (err) {
      console.error('å¯åŠ¨ç›¸æœºå¤±è´¥:', err)
    }
  }
  
  build() {
    Stack() {
      XComponent({
        id: 'camera',
        type: 'surface',
        controller: this.xComponentController
      })
      .width('100%')
      .height('100%')
      .onLoad(() => {
        this.surfaceId = this.xComponentController.getXComponentSurfaceId()
        this.startCamera()
      })
      
      Button('æ‹ç…§')
        .position({ x: '50%', y: '90%' })
        .translate({ x: '-50%', y: '-50%' })
    }
  }
}
```

## ğŸ“¸ æ‹ç…§åŠŸèƒ½

```typescript
async takePhoto() {
  try {
    // åˆ›å»ºæ‹ç…§è¾“å‡º
    const photoProfile = {
      format: camera.ImageFormat.JPEG,
      size: { width: 4000, height: 3000 }
    }
    const photoOutput = this.cameraManager!.createPhotoOutput(photoProfile)
    
    // ç›‘å¬æ‹ç…§å›è°ƒ
    photoOutput.on('photoAvailable', (photo) => {
      console.log('æ‹ç…§æˆåŠŸ')
      // ä¿å­˜ç…§ç‰‡
      this.savePhoto(photo)
    })
    
    // è§¦å‘æ‹ç…§
    await photoOutput.capture()
    
  } catch (err) {
    console.error('æ‹ç…§å¤±è´¥:', err)
  }
}
```

## ğŸ¥ å½•åƒåŠŸèƒ½

```typescript
async startVideoRecord() {
  try {
    // åˆ›å»ºå½•åƒè¾“å‡º
    const videoProfile = {
      format: camera.CameraFormat.CAMERA_FORMAT_YUV_420_SP,
      size: { width: 1920, height: 1080 },
      frameRate: 30
    }
    const videoOutput = this.cameraManager!.createVideoOutput(videoProfile)
    
    // å¼€å§‹å½•åˆ¶
    await videoOutput.start()
    
  } catch (err) {
    console.error('å½•åƒå¤±è´¥:', err)
  }
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æƒé™ç”³è¯·

```json5
// module.json5
{
  "requestPermissions": [
    {
      "name": "ohos.permission.CAMERA"
    }
  ]
}
```

### 2. é‡Šæ”¾èµ„æº

```typescript
aboutToDisappear() {
  if (this.session) {
    this.session.stop()
    this.session.release()
  }
}
```

## ğŸ“š å‚è€ƒèµ„æº

- [ç›¸æœºå¼€å‘æŒ‡å¯¼](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/camera-preparation-0000001821000709-V5)
- [Camera API](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-camera-0000001820880753-V5)

---

**ç¬¬12ç« å®Œæˆï¼** ç»§ç»­å­¦ä¹  â†’ [ç¬¬13ç« ï¼šæœåŠ¡ä¸å¡ç‰‡](../13-service-card-next/)
