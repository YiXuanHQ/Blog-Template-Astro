---
title: è¿›ç¨‹æ¨¡å‹
date: 2025-01-22
prevChapter: "harmonyos-dev/05-ability-framework/03-ç”Ÿå‘½å‘¨æœŸç®¡ç†"
parentChapter: "harmonyos-dev/05-ability-framework/README"
---
# è¿›ç¨‹æ¨¡å‹

> ç†è§£ HarmonyOS çš„è¿›ç¨‹æ¶æ„

## ğŸ—ï¸ è¿›ç¨‹æ¶æ„

### è¿›ç¨‹ç±»å‹

```
HarmonyOS è¿›ç¨‹æ¨¡å‹
â”œâ”€ ä¸»è¿›ç¨‹ï¼ˆMain Processï¼‰
â”‚   â””â”€ è¿è¡Œ UIAbility
â”œâ”€ æ¸²æŸ“è¿›ç¨‹ï¼ˆRender Processï¼‰
â”‚   â””â”€ UI æ¸²æŸ“
â””â”€ Extension è¿›ç¨‹
    â”œâ”€ FormExtension
    â””â”€ ServiceExtension
```

### è¿›ç¨‹é…ç½®

```json5
// module.json5
{
  "module": {
    "process": "com.example.myapp:main",  // è¿›ç¨‹å
    "abilities": [
      {
        "name": "MainAbility",
        "process": ""  // ä½¿ç”¨é»˜è®¤è¿›ç¨‹
      },
      {
        "name": "IsolatedAbility",
        "process": "com.example.myapp:isolated"  // ç‹¬ç«‹è¿›ç¨‹
      }
    ]
  }
}
```

## ğŸ”„ è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰

### ä½¿ç”¨ RPC

```typescript
import rpc from '@ohos.rpc'

// æœåŠ¡ç«¯
class MyStub extends rpc.RemoteObject {
  constructor(descriptor: string) {
    super(descriptor)
  }
  
  onRemoteRequest(code: number, data: rpc.MessageParcel, 
                  reply: rpc.MessageParcel, option: rpc.MessageOption): boolean {
    console.log('æ”¶åˆ°è¯·æ±‚, code:', code)
    
    if (code === 1) {
      // è¯»å–æ•°æ®
      const value = data.readInt()
      console.log('æ¥æ”¶åˆ°:', value)
      
      // å†™å…¥è¿”å›å€¼
      reply.writeInt(value * 2)
      return true
    }
    
    return false
  }
}

// å®¢æˆ·ç«¯
async function callRemoteService() {
  const proxy = /* è·å–è¿œç¨‹å¯¹è±¡ä»£ç† */
  
  const data = rpc.MessageParcel.create()
  const reply = rpc.MessageParcel.create()
  const option = new rpc.MessageOption()
  
  // å†™å…¥æ•°æ®
  data.writeInt(10)
  
  // å‘é€è¯·æ±‚
  await proxy.sendRequest(1, data, reply, option)
  
  // è¯»å–ç»“æœ
  const result = reply.readInt()
  console.log('ç»“æœ:', result)  // 20
  
  data.reclaim()
  reply.reclaim()
}
```

## ğŸ” è¿›ç¨‹éš”ç¦»

### æ•°æ®éš”ç¦»

```typescript
// è¿›ç¨‹ A
AppStorage.SetOrCreate('processA_data', 'Data from Process A')

// è¿›ç¨‹ Bï¼ˆæ— æ³•è®¿é—®è¿›ç¨‹ A çš„æ•°æ®ï¼‰
const data = AppStorage.Get('processA_data')  // undefined
```

### å®‰å…¨éš”ç¦»

```
å®‰å…¨æ²™ç®±
â”œâ”€ è¿›ç¨‹ A
â”‚   â””â”€ ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿ
â”‚   â””â”€ ç‹¬ç«‹çš„å†…å­˜ç©ºé—´
â””â”€ è¿›ç¨‹ B
    â””â”€ ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿ
    â””â”€ ç‹¬ç«‹çš„å†…å­˜ç©ºé—´
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. è¿›ç¨‹å¤ç”¨

```json5
// å¤šä¸ª Ability å…±äº«åŒä¸€è¿›ç¨‹
{
  "abilities": [
    {
      "name": "MainAbility",
      "process": "com.example.myapp:main"
    },
    {
      "name": "DetailAbility",
      "process": "com.example.myapp:main"  // å…±äº«è¿›ç¨‹
    }
  ]
}
```

### 2. æŒ‰éœ€åˆ›å»º

```typescript
// å»¶è¿ŸåŠ è½½é‡è¿›ç¨‹æœåŠ¡
async function loadHeavyService() {
  if (!this.heavyServiceLoaded) {
    await this.context.startServiceExtensionAbility(want)
    this.heavyServiceLoaded = true
  }
}
```

### 3. èµ„æºé™åˆ¶

```typescript
// ç›‘æ§è¿›ç¨‹å†…å­˜
import process from '@ohos.process'

function checkMemoryUsage() {
  const memInfo = process.getMemoryInfo()
  console.log('å†…å­˜ä½¿ç”¨:', memInfo.rss / 1024 / 1024, 'MB')
  
  if (memInfo.rss > 200 * 1024 * 1024) {
    // è¶…è¿‡200MBï¼Œæ¸…ç†èµ„æº
    this.cleanupResources()
  }
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åˆç†åˆ’åˆ†è¿›ç¨‹

```typescript
// âœ… ä¸»è¿›ç¨‹ - è½»é‡çº§ UI
MainAbility â†’ main process

// âœ… ç‹¬ç«‹è¿›ç¨‹ - é‡é‡çº§æœåŠ¡
DataProcessService â†’ isolated process
```

### 2. é¿å…è¿‡åº¦é€šä¿¡

```typescript
// âŒ é¢‘ç¹IPC
for (let i = 0; i < 1000; i++) {
  await sendIPC(i)
}

// âœ… æ‰¹é‡å¤„ç†
const batch = Array.from({ length: 1000 }, (_, i) => i)
await sendBatchIPC(batch)
```

## ğŸ“š å‚è€ƒèµ„æº

- [è¿›ç¨‹æ¨¡å‹å®˜æ–¹æ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/process-model-stage-0000001428061460-V3)

---

**ç¬¬5ç« å®Œæˆï¼** ç»§ç»­å­¦ä¹  â†’ [ç¬¬6ç« ï¼šå¯¼èˆªä¸è·¯ç”±](../06-navigation-router/)
