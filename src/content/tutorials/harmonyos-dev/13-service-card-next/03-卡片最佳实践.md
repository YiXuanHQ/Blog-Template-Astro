---
title: å¡ç‰‡æœ€ä½³å®è·µ
date: 2025-01-22
prevChapter: "harmonyos-dev/13-service-card-next/02-å¡ç‰‡äº¤äº’"
parentChapter: "harmonyos-dev/13-service-card-next/README"
---
# å¡ç‰‡æœ€ä½³å®è·µ

> ä¼˜åŒ–å¡ç‰‡æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. å‡å°‘æ•°æ®å¤§å°

```typescript
// âœ… åªä¼ é€’å¿…è¦æ•°æ®
const formData = {
  title: 'xxx',
  value: 123
}

// âŒ é¿å…ä¼ é€’å¤§é‡æ•°æ®
const formData = {
  largeArray: Array(1000).fill({}),  // å¤ªå¤§
  complexObject: { /* åµŒå¥—å¾ˆæ·± */ }
}
```

### 2. å›¾ç‰‡ä¼˜åŒ–

```typescript
// âœ… ä½¿ç”¨å‹ç¼©å›¾ç‰‡
Image(this.smallThumbnail)  // å°å°ºå¯¸ç¼©ç•¥å›¾
  .width(80)
  .height(80)

// âŒ é¿å…ä½¿ç”¨å¤§å›¾
Image(this.highResImage)  // é«˜åˆ†è¾¨ç‡åŸå›¾
```

### 3. æ›´æ–°é¢‘ç‡æ§åˆ¶

```typescript
class UpdateManager {
  private updateQueue: Map<string, number> = new Map()
  private readonly MIN_INTERVAL = 30000  // 30ç§’
  
  canUpdate(formId: string): boolean {
    const lastUpdate = this.updateQueue.get(formId) || 0
    const now = Date.now()
    
    if (now - lastUpdate < this.MIN_INTERVAL) {
      return false
    }
    
    this.updateQueue.set(formId, now)
    return true
  }
}
```

## ğŸ¨ æ ·å¼è®¾è®¡

### 1. å“åº”å¼å¸ƒå±€

```typescript
@Entry
@Component
struct ResponsiveCard {
  @LocalStorageProp('dimension') dimension: number = 2
  
  build() {
    Column() {
      if (this.dimension === 2) {
        // 2x2 å°å¡ç‰‡
        this.smallLayout()
      } else if (this.dimension === 4) {
        // 4x4 å¤§å¡ç‰‡
        this.largeLayout()
      }
    }
  }
  
  @Builder
  smallLayout() {
    Column({ space: 5 }) {
      Text('æ ‡é¢˜')
        .fontSize(14)
      
      Text('å†…å®¹')
        .fontSize(12)
    }
  }
  
  @Builder
  largeLayout() {
    Column({ space: 10 }) {
      Text('æ ‡é¢˜')
        .fontSize(18)
      
      List() {
        // æ›´å¤šå†…å®¹
      }
    }
  }
}
```

### 2. æ·±è‰²æ¨¡å¼é€‚é…

```typescript
@Entry
@Component
struct ThemeCard {
  @StorageProp('colorMode') colorMode: ColorMode = ColorMode.LIGHT
  
  build() {
    Column() {
      Text('å†…å®¹')
        .fontColor(this.colorMode === ColorMode.DARK ? Color.White : Color.Black)
    }
    .backgroundColor(this.colorMode === ColorMode.DARK ? '#1E1E1E' : Color.White)
  }
}
```

## ğŸ“Š æ•°æ®ç®¡ç†

### 1. æ•°æ®ç¼“å­˜

```typescript
class CardDataManager {
  private cache: Map<string, CachedData> = new Map()
  private readonly CACHE_DURATION = 5 * 60 * 1000  // 5åˆ†é’Ÿ
  
  async getData(key: string): Promise<any> {
    const cached = this.cache.get(key)
    
    if (cached && Date.now() - cached.timestamp < this.CACHE_DURATION) {
      return cached.data
    }
    
    const freshData = await this.fetchData(key)
    this.cache.set(key, {
      data: freshData,
      timestamp: Date.now()
    })
    
    return freshData
  }
  
  async fetchData(key: string): Promise<any> {
    // ä»ç½‘ç»œæˆ–æ•°æ®åº“è·å–
    return {}
  }
}

interface CachedData {
  data: any
  timestamp: number
}
```

### 2. é”™è¯¯å¤„ç†

```typescript
export default class WeatherFormAbility extends FormExtensionAbility {
  onUpdateForm(formId: string) {
    try {
      const data = this.getWeatherData()
      return formBindingData.createFormBindingData(data)
    } catch (err) {
      console.error('è·å–æ•°æ®å¤±è´¥:', err)
      
      // è¿”å›é”™è¯¯çŠ¶æ€
      return formBindingData.createFormBindingData({
        error: true,
        message: 'æ•°æ®åŠ è½½å¤±è´¥'
      })
    }
  }
}

// å¡ç‰‡æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
@Entry
@Component
struct WeatherCard {
  @LocalStorageProp('error') error: boolean = false
  @LocalStorageProp('message') message: string = ''
  
  build() {
    if (this.error) {
      Column() {
        Text('âš ï¸')
          .fontSize(32)
        
        Text(this.message)
          .fontSize(14)
          .fontColor(Color.Red)
        
        Button('é‡è¯•')
          .onClick(() => {
            postCardAction(this, {
              action: formInfo.FormAction.MESSAGE,
              params: JSON.stringify({ action: 'retry' })
            })
          })
      }
    } else {
      // æ­£å¸¸æ˜¾ç¤º
    }
  }
}
```

## ğŸ”‹ ç”µæ± ä¼˜åŒ–

### 1. æ™ºèƒ½æ›´æ–°ç­–ç•¥

```typescript
class SmartUpdateManager {
  async shouldUpdate(): Promise<boolean> {
    // æ£€æŸ¥ç”µé‡
    const battery = await batteryInfo.getBatteryInfo()
    if (battery.batteryLevel < 20) {
      return false  // ä½ç”µé‡æ—¶ä¸æ›´æ–°
    }
    
    // æ£€æŸ¥ç½‘ç»œ
    const connection = await connection.getDefaultNet()
    if (connection.netCapabilities.bearerTypes.includes(NetBearerType.BEARER_CELLULAR)) {
      return false  // ç§»åŠ¨ç½‘ç»œæ—¶ä¸æ›´æ–°
    }
    
    return true
  }
}
```

### 2. åå°ä»»åŠ¡ç®¡ç†

```typescript
class BackgroundTaskManager {
  startLongRunningTask() {
    backgroundTaskManager.requestBackgroundRunning(getContext(), {
      bgMode: backgroundTaskManager.BackgroundMode.DATA_TRANSFER,
      wantAgent: null
    }, (err) => {
      if (!err) {
        console.log('åå°ä»»åŠ¡å·²å¯åŠ¨')
      }
    })
  }
  
  stopLongRunningTask() {
    backgroundTaskManager.stopBackgroundRunning(getContext(), (err) => {
      if (!err) {
        console.log('åå°ä»»åŠ¡å·²åœæ­¢')
      }
    })
  }
}
```

## ğŸ’¡ ç”¨æˆ·ä½“éªŒ

### 1. åŠ è½½çŠ¶æ€

```typescript
@Entry
@Component
struct LoadingCard {
  @LocalStorageProp('loading') loading: boolean = false
  @LocalStorageProp('data') data: any = null
  
  build() {
    Column() {
      if (this.loading) {
        LoadingProgress()
          .width(40)
          .height(40)
      } else if (this.data) {
        // æ˜¾ç¤ºæ•°æ®
        this.contentView()
      } else {
        // ç©ºçŠ¶æ€
        Text('æš‚æ— æ•°æ®')
          .fontColor(Color.Gray)
      }
    }
  }
  
  @Builder
  contentView() {
    // å†…å®¹è§†å›¾
  }
}
```

### 2. å¹³æ»‘åŠ¨ç”»

```typescript
@Entry
@Component
struct AnimatedCard {
  @State value: number = 0
  
  build() {
    Column() {
      Text(`${this.value}`)
        .fontSize(32)
        .animation({
          duration: 500,
          curve: Curve.EaseInOut
        })
    }
  }
}
```

## ğŸ“š å‚è€ƒèµ„æº

- [å¡ç‰‡å¼€å‘æŒ‡å—](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-ui-widget-working-principles-0000001820880617-V5)

---

**ç¬¬13ç« å®Œæˆï¼** ç»§ç»­å­¦ä¹  â†’ [ç¬¬14ç« ï¼šå®‰å…¨ä¸éšç§](../14-security-privacy/)
