---
title: åˆ†å¸ƒå¼ç¡¬ä»¶è™šæ‹ŸåŒ–
date: 2025-01-22
nextChapter: "harmonyos-dev/10-distributed-next/02-è·¨è®¾å¤‡æµè½¬"
parentChapter: "harmonyos-dev/10-distributed-next/README"
---
# åˆ†å¸ƒå¼ç¡¬ä»¶è™šæ‹ŸåŒ–

> HarmonyOS NEXT çš„æ ¸å¿ƒç«äº‰åŠ›

## ğŸŒ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç¡¬ä»¶è™šæ‹ŸåŒ–

### æ ¸å¿ƒæ¦‚å¿µ

**ç¡¬ä»¶è™šæ‹ŸåŒ–**ï¼šå°†å¤šä¸ªè®¾å¤‡çš„ç¡¬ä»¶èƒ½åŠ›è™šæ‹Ÿæˆä¸€ä¸ªç»Ÿä¸€çš„ç¡¬ä»¶èµ„æºæ± ï¼Œåº”ç”¨å¯ä»¥åƒè°ƒç”¨æœ¬åœ°ç¡¬ä»¶ä¸€æ ·è°ƒç”¨è¿œç¨‹è®¾å¤‡çš„ç¡¬ä»¶ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š
æ‰‹æœº â†’ åªèƒ½ç”¨æ‰‹æœºçš„ç›¸æœº
å¹³æ¿ â†’ åªèƒ½ç”¨å¹³æ¿çš„ç›¸æœº

åˆ†å¸ƒå¼ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼š
æ‰‹æœº â†’ å¯ä»¥è°ƒç”¨å¹³æ¿çš„ç›¸æœº
å¹³æ¿ â†’ å¯ä»¥è°ƒç”¨æ‰‹æœºçš„ç›¸æœº
```

### æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      åº”ç”¨å±‚                      â”‚
â”‚  (ç»Ÿä¸€çš„ç¡¬ä»¶è°ƒç”¨æ¥å£)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åˆ†å¸ƒå¼ç¡¬ä»¶ç®¡ç†æ¡†æ¶              â”‚
â”‚  â”œâ”€ è®¾å¤‡å‘ç°                     â”‚
â”‚  â”œâ”€ èƒ½åŠ›åå•†                     â”‚
â”‚  â””â”€ èµ„æºè°ƒåº¦                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      åˆ†å¸ƒå¼è½¯æ€»çº¿                â”‚
â”‚  (è®¾å¤‡é—´é€šä¿¡)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æœ¬åœ°è®¾å¤‡  â†â†’  è¿œç¨‹è®¾å¤‡          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ”¯æŒçš„ç¡¬ä»¶ç±»å‹

### 1. ç›¸æœºï¼ˆCameraï¼‰

```typescript
import distributedHardware from '@ohos.distributedHardware'

// è·å–æ‰€æœ‰å¯ç”¨ç›¸æœºï¼ˆåŒ…æ‹¬è¿œç¨‹è®¾å¤‡ï¼‰
const cameras = await distributedHardware.getCameraList()

cameras.forEach(camera => {
  console.log('ç›¸æœºID:', camera.cameraId)
  console.log('è®¾å¤‡ID:', camera.deviceId)
  console.log('æ˜¯å¦æœ¬åœ°:', camera.isLocal)
  console.log('ç›¸æœºä½ç½®:', camera.position)  // FRONT/BACK
})

// ä½¿ç”¨è¿œç¨‹è®¾å¤‡çš„ç›¸æœº
const remoteCamera = cameras.find(c => !c.isLocal)
if (remoteCamera) {
  const cameraSession = await camera.createCameraSession(remoteCamera.cameraId)
  // æ‹ç…§
  await cameraSession.takePicture()
}
```

### 2. å±å¹•ï¼ˆDisplayï¼‰

```typescript
// æŠ•å±åˆ°è¿œç¨‹è®¾å¤‡
import screenShare from '@ohos.distributedHardware.screenShare'

// å‘ç°å¯æŠ•å±è®¾å¤‡
const displays = await screenShare.getAvailableDisplays()

// å¼€å§‹æŠ•å±
await screenShare.startShare({
  targetDeviceId: displays[0].deviceId,
  quality: 'HIGH',  // ç”»è´¨ï¼šHIGH/MEDIUM/LOW
  fps: 60           // å¸§ç‡
})

// åœæ­¢æŠ•å±
await screenShare.stopShare()
```

### 3. æ‰¬å£°å™¨ï¼ˆSpeakerï¼‰

```typescript
import audio from '@ohos.multimedia.audio'

// è·å–æ‰€æœ‰éŸ³é¢‘è¾“å‡ºè®¾å¤‡
const audioDevices = await audio.getDevices(audio.DeviceType.OUTPUT)

// é€‰æ‹©è¿œç¨‹è®¾å¤‡çš„æ‰¬å£°å™¨
const remoteSpeaker = audioDevices.find(d => 
  d.deviceType === audio.DeviceType.SPEAKER && 
  !d.isLocal
)

if (remoteSpeaker) {
  // è®¾ç½®éŸ³é¢‘è¾“å‡ºåˆ°è¿œç¨‹è®¾å¤‡
  await audio.selectOutputDevice([remoteSpeaker.id])
}
```

### 4. ä¼ æ„Ÿå™¨ï¼ˆSensorï¼‰

```typescript
import sensor from '@ohos.sensor'

// è·å–è¿œç¨‹è®¾å¤‡çš„ä¼ æ„Ÿå™¨æ•°æ®
sensor.on(sensor.SensorId.ACCELEROMETER, (data) => {
  console.log('åŠ é€Ÿåº¦:', data.x, data.y, data.z)
  console.log('è®¾å¤‡ID:', data.deviceId)
}, {
  deviceId: 'remote-device-id',  // æŒ‡å®šè¿œç¨‹è®¾å¤‡
  interval: 100  // é‡‡æ ·é—´éš”ï¼ˆæ¯«ç§’ï¼‰
})
```

## ğŸ” è®¾å¤‡å‘ç°ä¸è¿æ¥

### è®¾å¤‡å‘ç°

```typescript
import deviceManager from '@ohos.distributedDeviceManager'

@Entry
@Component
struct DeviceDiscovery {
  @State devices: DeviceInfo[] = []
  private dmInstance: deviceManager.DeviceManager
  
  async aboutToAppear() {
    // åˆ›å»ºè®¾å¤‡ç®¡ç†å®ä¾‹
    this.dmInstance = await deviceManager.createDeviceManager('com.example.app')
    
    // è·å–å¯ä¿¡è®¾å¤‡åˆ—è¡¨
    this.devices = this.dmInstance.getAvailableDeviceListSync()
    
    // ç›‘å¬è®¾å¤‡ä¸Šçº¿
    this.dmInstance.on('discoverSuccess', (device) => {
      console.log('å‘ç°è®¾å¤‡:', device.deviceName)
      this.devices.push(device)
    })
    
    // ç›‘å¬è®¾å¤‡ä¸‹çº¿
    this.dmInstance.on('discoverFailure', (device) => {
      console.log('è®¾å¤‡ç¦»çº¿:', device.deviceName)
      this.devices = this.devices.filter(d => d.deviceId !== device.deviceId)
    })
    
    // å¼€å§‹å‘ç°è®¾å¤‡
    this.dmInstance.startDiscovering({
      discoverTargetType: deviceManager.TargetType.ALL
    })
  }
  
  aboutToDisappear() {
    // åœæ­¢å‘ç°
    this.dmInstance.stopDiscovering()
  }
  
  build() {
    Column() {
      Text('å¯ç”¨è®¾å¤‡')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
      
      List() {
        ForEach(this.devices, (device: DeviceInfo) => {
          ListItem() {
            Row() {
              Column({ space: 5 }) {
                Text(device.deviceName)
                  .fontSize(18)
                Text(device.deviceType)
                  .fontSize(14)
                  .fontColor(Color.Gray)
              }
              .alignItems(HorizontalAlign.Start)
              .layoutWeight(1)
              
              Text(device.isOnline ? 'åœ¨çº¿' : 'ç¦»çº¿')
                .fontColor(device.isOnline ? Color.Green : Color.Gray)
            }
            .width('100%')
            .padding(15)
          }
        })
      }
    }
    .padding(20)
  }
}
```

### è®¾å¤‡è®¤è¯

```typescript
// å‘èµ·è®¾å¤‡è®¤è¯
async authenticateDevice(deviceId: string) {
  try {
    await this.dmInstance.authenticateDevice({
      deviceId: deviceId,
      authType: deviceManager.AuthType.PIN,  // PIN ç è®¤è¯
      extraInfo: {
        pinCode: '123456'
      }
    })
    
    console.log('è®¤è¯æˆåŠŸ')
  } catch (err) {
    console.error('è®¤è¯å¤±è´¥:', err)
  }
}
```

## ğŸ“¸ å®æˆ˜æ¡ˆä¾‹ï¼šè·¨è®¾å¤‡æ‹ç…§

### å®Œæ•´ç¤ºä¾‹

```typescript
import distributedHardware from '@ohos.distributedHardware'
import camera from '@ohos.multimedia.camera'
import deviceManager from '@ohos.distributedDeviceManager'

@Entry
@Component
struct RemoteCameraApp {
  @State devices: DeviceInfo[] = []
  @State selectedDevice: DeviceInfo = null
  @State photoUri: string = ''
  private dmInstance: deviceManager.DeviceManager
  
  async aboutToAppear() {
    // åˆå§‹åŒ–è®¾å¤‡ç®¡ç†
    this.dmInstance = await deviceManager.createDeviceManager('com.example.remotecamera')
    this.devices = this.dmInstance.getAvailableDeviceListSync()
  }
  
  async takePictureWithRemoteCamera() {
    if (!this.selectedDevice) {
      return
    }
    
    try {
      // 1. è·å–è¿œç¨‹è®¾å¤‡çš„ç›¸æœºåˆ—è¡¨
      const cameras = await distributedHardware.getCameraList({
        deviceId: this.selectedDevice.deviceId
      })
      
      if (cameras.length === 0) {
        console.error('è¿œç¨‹è®¾å¤‡æ²¡æœ‰å¯ç”¨ç›¸æœº')
        return
      }
      
      // 2. é€‰æ‹©åç½®ç›¸æœº
      const backCamera = cameras.find(c => 
        c.position === camera.CameraPosition.BACK
      ) || cameras[0]
      
      // 3. åˆ›å»ºç›¸æœºä¼šè¯
      const cameraManager = camera.getCameraManager()
      const cameraInput = await cameraManager.createCameraInput(backCamera)
      const previewOutput = await cameraManager.createPreviewOutput()
      const photoOutput = await cameraManager.createPhotoOutput()
      
      const session = await cameraManager.createCaptureSession()
      await session.beginConfig()
      await session.addInput(cameraInput)
      await session.addOutput(previewOutput)
      await session.addOutput(photoOutput)
      await session.commitConfig()
      
      // 4. æ‹ç…§
      await session.start()
      const photo = await photoOutput.capture()
      
      // 5. ä¿å­˜ç…§ç‰‡
      this.photoUri = photo.uri
      console.log('ç…§ç‰‡å·²ä¿å­˜:', this.photoUri)
      
      // 6. é‡Šæ”¾èµ„æº
      await session.stop()
      await session.release()
      
    } catch (err) {
      console.error('æ‹ç…§å¤±è´¥:', err)
    }
  }
  
  build() {
    Column({ space: 20 }) {
      Text('è·¨è®¾å¤‡æ‹ç…§')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
      
      // è®¾å¤‡é€‰æ‹©
      Text('é€‰æ‹©è®¾å¤‡:')
        .fontSize(18)
      
      List() {
        ForEach(this.devices, (device: DeviceInfo) => {
          ListItem() {
            Row() {
              Text(device.deviceName)
                .layoutWeight(1)
              
              Radio({ value: device.deviceId, group: 'device' })
                .checked(this.selectedDevice?.deviceId === device.deviceId)
                .onChange((isChecked) => {
                  if (isChecked) {
                    this.selectedDevice = device
                  }
                })
            }
            .width('100%')
            .padding(10)
          }
        })
      }
      .height(200)
      
      // æ‹ç…§æŒ‰é’®
      Button('ä½¿ç”¨è¿œç¨‹ç›¸æœºæ‹ç…§')
        .width('80%')
        .height(50)
        .enabled(this.selectedDevice !== null)
        .onClick(() => {
          this.takePictureWithRemoteCamera()
        })
      
      // æ˜¾ç¤ºç…§ç‰‡
      if (this.photoUri) {
        Image(this.photoUri)
          .width('100%')
          .height(300)
          .objectFit(ImageFit.Contain)
      }
    }
    .width('100%')
    .height('100%')
    .padding(20)
  }
}
```

## ğŸµ å®æˆ˜æ¡ˆä¾‹ï¼šåˆ†å¸ƒå¼éŸ³ä¹æ’­æ”¾

```typescript
import audio from '@ohos.multimedia.audio'
import deviceManager from '@ohos.distributedDeviceManager'

@Entry
@Component
struct DistributedMusicPlayer {
  @State devices: DeviceInfo[] = []
  @State selectedDevices: string[] = []  // å¤šä¸ªè®¾å¤‡åŒæ—¶æ’­æ”¾
  @State isPlaying: boolean = false
  private audioRenderer: audio.AudioRenderer
  
  async playOnMultipleDevices() {
    try {
      // 1. è·å–æ‰€æœ‰éŸ³é¢‘è¾“å‡ºè®¾å¤‡
      const audioDevices = await audio.getDevices(audio.DeviceType.OUTPUT)
      
      // 2. ç­›é€‰é€‰ä¸­çš„è®¾å¤‡
      const targetDevices = audioDevices.filter(d => 
        this.selectedDevices.includes(d.deviceId)
      )
      
      // 3. è®¾ç½®å¤šè®¾å¤‡è¾“å‡º
      await audio.selectOutputDevice(targetDevices.map(d => d.id))
      
      // 4. å¼€å§‹æ’­æ”¾
      await this.audioRenderer.start()
      this.isPlaying = true
      
      console.log(`æ­£åœ¨ ${targetDevices.length} ä¸ªè®¾å¤‡ä¸Šæ’­æ”¾éŸ³ä¹`)
      
    } catch (err) {
      console.error('æ’­æ”¾å¤±è´¥:', err)
    }
  }
  
  build() {
    Column({ space: 20 }) {
      Text('åˆ†å¸ƒå¼éŸ³ä¹æ’­æ”¾')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
      
      Text('é€‰æ‹©æ’­æ”¾è®¾å¤‡ï¼ˆå¯å¤šé€‰ï¼‰:')
        .fontSize(18)
      
      List() {
        ForEach(this.devices, (device: DeviceInfo) => {
          ListItem() {
            Row() {
              Text(device.deviceName)
                .layoutWeight(1)
              
              Checkbox()
                .select(this.selectedDevices.includes(device.deviceId))
                .onChange((checked) => {
                  if (checked) {
                    this.selectedDevices.push(device.deviceId)
                  } else {
                    const index = this.selectedDevices.indexOf(device.deviceId)
                    if (index >= 0) {
                      this.selectedDevices.splice(index, 1)
                    }
                  }
                })
            }
            .width('100%')
            .padding(10)
          }
        })
      }
      
      Button(this.isPlaying ? 'åœæ­¢' : 'æ’­æ”¾')
        .width('80%')
        .onClick(() => {
          if (this.isPlaying) {
            this.audioRenderer.stop()
            this.isPlaying = false
          } else {
            this.playOnMultipleDevices()
          }
        })
    }
    .padding(20)
  }
}
```

## ğŸ”’ å®‰å…¨ä¸æƒé™

### æƒé™å£°æ˜

```json5
// module.json5
{
  "module": {
    "requestPermissions": [
      {
        "name": "ohos.permission.DISTRIBUTED_DATASYNC",
        "reason": "ç”¨äºè®¾å¤‡é—´æ•°æ®åŒæ­¥",
        "usedScene": {
          "abilities": ["MainAbility"],
          "when": "inuse"
        }
      },
      {
        "name": "ohos.permission.CAMERA",
        "reason": "ç”¨äºè®¿é—®ç›¸æœº",
        "usedScene": {
          "abilities": ["MainAbility"],
          "when": "inuse"
        }
      }
    ]
  }
}
```

### è¿è¡Œæ—¶æƒé™è¯·æ±‚

```typescript
import abilityAccessCtrl from '@ohos.abilityAccessCtrl'

async requestPermissions() {
  const atManager = abilityAccessCtrl.createAtManager()
  
  try {
    await atManager.requestPermissionsFromUser(this.context, [
      'ohos.permission.DISTRIBUTED_DATASYNC',
      'ohos.permission.CAMERA'
    ])
    
    console.log('æƒé™å·²æˆäºˆ')
  } catch (err) {
    console.error('æƒé™è¯·æ±‚å¤±è´¥:', err)
  }
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. è®¾å¤‡åœ¨çº¿æ£€æµ‹

```typescript
// å®šæœŸæ£€æŸ¥è®¾å¤‡åœ¨çº¿çŠ¶æ€
setInterval(() => {
  this.devices.forEach(device => {
    deviceManager.isDeviceOnline(device.deviceId).then(isOnline => {
      device.isOnline = isOnline
    })
  })
}, 5000)
```

### 2. ç½‘ç»œè´¨é‡æ£€æµ‹

```typescript
// æ£€æŸ¥ç½‘ç»œè´¨é‡
const quality = await distributedHardware.getConnectionQuality(deviceId)

if (quality === 'POOR') {
  console.warn('ç½‘ç»œè´¨é‡å·®ï¼Œå¯èƒ½å½±å“ä½¿ç”¨')
}
```

### 3. é™çº§ç­–ç•¥

```typescript
async takePicture() {
  try {
    // ä¼˜å…ˆä½¿ç”¨è¿œç¨‹è®¾å¤‡
    await this.useRemoteCamera()
  } catch (err) {
    console.warn('è¿œç¨‹ç›¸æœºä¸å¯ç”¨ï¼Œä½¿ç”¨æœ¬åœ°ç›¸æœº')
    // é™çº§åˆ°æœ¬åœ°ç›¸æœº
    await this.useLocalCamera()
  }
}
```

## ğŸ“š å‚è€ƒèµ„æº

- [åˆ†å¸ƒå¼ç¡¬ä»¶å®˜æ–¹æ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/distributed-hardware-overview-0000001478341037-V3)
- [è®¾å¤‡ç®¡ç† API](https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/js-apis-distributedDeviceManager-0000001478341433-V3)

---

**ä¸‹ä¸€èŠ‚** â†’ [è·¨è®¾å¤‡æµè½¬](02-è·¨è®¾å¤‡æµè½¬.md)
