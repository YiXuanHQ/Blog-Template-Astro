---
title: åˆ†å¸ƒå¼ç»„ä»¶
date: 2025-01-22
prevChapter: "harmonyos-dev/10-distributed-next/02-è·¨è®¾å¤‡æµè½¬"
nextChapter: "harmonyos-dev/10-distributed-next/04-å¤šç«¯ååŒå¼€å‘"
parentChapter: "harmonyos-dev/10-distributed-next/README"
---
# åˆ†å¸ƒå¼ç»„ä»¶

> è·¨è®¾å¤‡çš„åˆ†å¸ƒå¼èƒ½åŠ›ç»„ä»¶

## ğŸ”— åˆ†å¸ƒå¼æ•°æ®å¯¹è±¡

### åˆ›å»ºåˆ†å¸ƒå¼å¯¹è±¡

```typescript
import { distributedDataObject } from '@kit.ArkData'

// åˆ›å»ºåˆ†å¸ƒå¼å¯¹è±¡
const source = {
  name: 'Alice',
  age: 25,
  score: 0
}

const distributedObj = distributedDataObject.create(context, source)

// è®¾ç½®ä¼šè¯IDï¼ˆåŒä¸€ä¼šè¯çš„è®¾å¤‡å¯ä»¥åŒæ­¥ï¼‰
distributedObj.setSessionId('session_123')

// ç›‘å¬æ•°æ®å˜åŒ–
distributedObj.on('change', (sessionId, fields) => {
  console.log('æ•°æ®å˜åŒ–:', fields)
  fields.forEach(field => {
    console.log(`${field}: ${distributedObj[field]}`)
  })
})

// ä¿®æ”¹æ•°æ®ï¼ˆä¼šè‡ªåŠ¨åŒæ­¥åˆ°å…¶ä»–è®¾å¤‡ï¼‰
distributedObj.name = 'Bob'
distributedObj.score = 100
```

### å®æˆ˜ï¼šååŒç»˜å›¾

```typescript
@Entry
@Component
struct CollaborativeDrawing {
  @State strokes: Stroke[] = []
  private distributedObj: distributedDataObject.DataObject
  private canvas: CanvasRenderingContext2D
  
  async aboutToAppear() {
    // åˆ›å»ºåˆ†å¸ƒå¼å¯¹è±¡
    this.distributedObj = distributedDataObject.create(getContext(this), {
      strokes: []
    })
    
    // åŠ å…¥ä¼šè¯
    this.distributedObj.setSessionId('drawing_session')
    
    // ç›‘å¬å…¶ä»–è®¾å¤‡çš„ç»˜åˆ¶
    this.distributedObj.on('change', (sessionId, fields) => {
      if (fields.includes('strokes')) {
        this.strokes = JSON.parse(JSON.stringify(this.distributedObj['strokes']))
        this.redrawCanvas()
      }
    })
  }
  
  onTouchMove(event: TouchEvent) {
    const x = event.touches[0].x
    const y = event.touches[0].y
    
    // æ·»åŠ ç¬”è§¦
    const stroke = { x, y, timestamp: Date.now() }
    this.strokes.push(stroke)
    
    // åŒæ­¥åˆ°å…¶ä»–è®¾å¤‡
    this.distributedObj['strokes'] = this.strokes
    
    // ç»˜åˆ¶
    this.drawStroke(stroke)
  }
  
  drawStroke(stroke: Stroke) {
    this.canvas.lineTo(stroke.x, stroke.y)
    this.canvas.stroke()
  }
  
  redrawCanvas() {
    this.canvas.clearRect(0, 0, 800, 600)
    this.strokes.forEach(stroke => {
      this.drawStroke(stroke)
    })
  }
  
  build() {
    Column() {
      Text('ååŒç»˜å›¾æ¿')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
      
      Text('å¤šè®¾å¤‡å®æ—¶åŒæ­¥')
        .fontSize(14)
        .fontColor(Color.Gray)
      
      Canvas(this.canvas)
        .width('100%')
        .height(600)
        .backgroundColor(Color.White)
        .border({ width: 1, color: Color.Gray })
        .onReady(() => {
          this.canvas.lineWidth = 3
          this.canvas.strokeStyle = '#007DFF'
        })
        .onTouch((event) => {
          if (event.type === TouchType.Move) {
            this.onTouchMove(event)
          }
        })
      
      Row({ space: 10 }) {
        Button('æ¸…ç©ºç”»å¸ƒ')
          .onClick(() => {
            this.strokes = []
            this.distributedObj['strokes'] = []
            this.canvas.clearRect(0, 0, 800, 600)
          })
      }
      .margin({ top: 20 })
    }
    .padding(20)
  }
}

interface Stroke {
  x: number
  y: number
  timestamp: number
}
```

## ğŸ”” è·¨è®¾å¤‡é€šçŸ¥

### å‘é€åˆ†å¸ƒå¼é€šçŸ¥

```typescript
import { notificationManager } from '@kit.NotificationKit'
import { wantAgent } from '@kit.AbilityKit'

async function sendDistributedNotification() {
  // åˆ›å»ºé€šçŸ¥è¯·æ±‚
  const notificationRequest = {
    id: 1,
    content: {
      notificationContentType: notificationManager.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT,
      normal: {
        title: 'åˆ†å¸ƒå¼é€šçŸ¥',
        text: 'æ‚¨æœ‰æ–°æ¶ˆæ¯',
        additionalText: 'æ¥è‡ªæ‰‹æœº'
      }
    },
    // åˆ†å¸ƒå¼é€šçŸ¥é…ç½®
    isDistributed: true,
    deviceId: 'target_device_id'
  }
  
  // å‘å¸ƒé€šçŸ¥
  await notificationManager.publish(notificationRequest)
}
```

## ğŸš€ è¿œç¨‹æ‹‰èµ·

### æ‹‰èµ·è¿œç¨‹è®¾å¤‡åº”ç”¨

```typescript
import { deviceManager } from '@kit.DistributedServiceKit'
import { Want } from '@kit.AbilityKit'

async function startRemoteAbility(deviceId: string) {
  const want: Want = {
    bundleName: 'com.example.myapp',
    abilityName: 'MainAbility',
    deviceId: deviceId,  // ç›®æ ‡è®¾å¤‡ID
    parameters: {
      message: 'æ¥è‡ªè¿œç¨‹è®¾å¤‡'
    }
  }
  
  try {
    await this.context.startAbility(want)
    console.log('è¿œç¨‹æ‹‰èµ·æˆåŠŸ')
  } catch (err) {
    console.error('è¿œç¨‹æ‹‰èµ·å¤±è´¥:', err)
  }
}
```

## ğŸ¯ å®æˆ˜ï¼šå¤šè®¾å¤‡ååŒç¬”è®°

```typescript
@Entry
@Component
struct CollaborativeNotes {
  @State notes: Note[] = []
  private distributedObj: distributedDataObject.DataObject
  @State currentDeviceName: string = ''
  
  async aboutToAppear() {
    // åˆå§‹åŒ–åˆ†å¸ƒå¼å¯¹è±¡
    this.distributedObj = distributedDataObject.create(getContext(this), {
      notes: []
    })
    
    // è·å–å½“å‰è®¾å¤‡å
    this.currentDeviceName = await this.getDeviceName()
    
    // åŠ å…¥ååŒä¼šè¯
    this.distributedObj.setSessionId('notes_collaboration')
    
    // ç›‘å¬æ•°æ®å˜åŒ–
    this.distributedObj.on('change', (sessionId, fields) => {
      if (fields.includes('notes')) {
        this.notes = JSON.parse(JSON.stringify(this.distributedObj['notes']))
        this.sortNotes()
      }
    })
    
    // åŠ è½½åˆå§‹æ•°æ®
    this.loadNotes()
  }
  
  async getDeviceName(): Promise<string> {
    // è·å–è®¾å¤‡ä¿¡æ¯
    return 'Device-1'
  }
  
  loadNotes() {
    const savedNotes = this.distributedObj['notes'] || []
    this.notes = JSON.parse(JSON.stringify(savedNotes))
  }
  
  addNote(content: string) {
    const newNote: Note = {
      id: Date.now().toString(),
      content: content,
      deviceName: this.currentDeviceName,
      timestamp: Date.now()
    }
    
    this.notes.push(newNote)
    this.distributedObj['notes'] = this.notes
  }
  
  deleteNote(id: string) {
    this.notes = this.notes.filter(note => note.id !== id)
    this.distributedObj['notes'] = this.notes
  }
  
  sortNotes() {
    this.notes.sort((a, b) => b.timestamp - a.timestamp)
  }
  
  build() {
    Column() {
      // æ ‡é¢˜
      Row({ space: 10 }) {
        Text('ååŒç¬”è®°')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
        
        Text(`(${this.currentDeviceName})`)
          .fontSize(14)
          .fontColor(Color.Gray)
      }
      .width('100%')
      .margin({ bottom: 20 })
      
      // æ·»åŠ ç¬”è®°
      Row({ space: 10 }) {
        TextInput({ placeholder: 'è¾“å…¥æ–°ç¬”è®°' })
          .layoutWeight(1)
          .onSubmit((value) => {
            if (value.trim()) {
              this.addNote(value)
            }
          })
        
        Button('æ·»åŠ ')
          .onClick(() => {
            // é€šè¿‡è¾“å…¥æ¡†æ·»åŠ 
          })
      }
      .margin({ bottom: 20 })
      
      // ç¬”è®°åˆ—è¡¨
      List({ space: 10 }) {
        ForEach(this.notes, (note: Note) => {
          ListItem() {
            Row() {
              Column({ space: 5 }) {
                Text(note.content)
                  .fontSize(16)
                  .maxLines(2)
                  .textOverflow({ overflow: TextOverflow.Ellipsis })
                
                Row({ space: 10 }) {
                  Text(note.deviceName)
                    .fontSize(12)
                    .fontColor(Color.Gray)
                  
                  Text(this.formatTime(note.timestamp))
                    .fontSize(12)
                    .fontColor(Color.Gray)
                }
              }
              .layoutWeight(1)
              .alignItems(HorizontalAlign.Start)
              
              Button('åˆ é™¤')
                .fontSize(14)
                .onClick(() => {
                  this.deleteNote(note.id)
                })
            }
            .width('100%')
            .padding(15)
            .backgroundColor(Color.White)
            .borderRadius(8)
          }
        })
      }
      .layoutWeight(1)
      
      Text(`å…± ${this.notes.length} æ¡ç¬”è®°`)
        .fontSize(14)
        .fontColor(Color.Gray)
        .margin({ top: 10 })
    }
    .padding(20)
    .width('100%')
    .height('100%')
    .backgroundColor(0xF5F5F5)
  }
  
  formatTime(timestamp: number): string {
    const date = new Date(timestamp)
    return `${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`
  }
}

interface Note {
  id: string
  content: string
  deviceName: string
  timestamp: number
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¼šè¯ç®¡ç†

```typescript
// âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„ä¼šè¯ID
distributedObj.setSessionId('room_123_whiteboard')

// âœ… åŠæ—¶é€€å‡ºä¼šè¯
distributedObj.setSessionId('')  // é€€å‡ºä¼šè¯
```

### 2. æ•°æ®åŒæ­¥ä¼˜åŒ–

```typescript
// âœ… æ‰¹é‡æ›´æ–°
const updates = {
  field1: value1,
  field2: value2,
  field3: value3
}
Object.assign(distributedObj, updates)

// âŒ é¿å…é¢‘ç¹å•ä¸ªæ›´æ–°
distributedObj.field1 = value1
distributedObj.field2 = value2
distributedObj.field3 = value3
```

### 3. å†²çªå¤„ç†

```typescript
// ä½¿ç”¨æ—¶é—´æˆ³è§£å†³å†²çª
interface DataWithTimestamp {
  value: any
  timestamp: number
  deviceId: string
}

distributedObj.on('change', (sessionId, fields) => {
  fields.forEach(field => {
    const remote = distributedObj[field]
    const local = localData[field]
    
    // æ—¶é—´æˆ³è¾ƒæ–°çš„ä¼˜å…ˆ
    if (remote.timestamp > local.timestamp) {
      localData[field] = remote
    }
  })
})
```

## ğŸ“š å‚è€ƒèµ„æº

- [åˆ†å¸ƒå¼æ•°æ®å¯¹è±¡](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/data-object-guidelines-0000001774280566-V5)
- [åˆ†å¸ƒå¼é€šçŸ¥](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/notification-guidelines-0000001815767648-V5)

---

**ä¸‹ä¸€èŠ‚** â†’ [å¤šç«¯ååŒå¼€å‘](04-å¤šç«¯ååŒå¼€å‘.md)
