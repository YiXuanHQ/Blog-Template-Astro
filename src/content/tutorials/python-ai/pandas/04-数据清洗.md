---
title: æ•°æ®æ¸…æ´—
prevChapter: "python-ai/pandas/03-æ•°æ®é€‰æ‹©ä¸ç´¢å¼•"
nextChapter: "python-ai/pandas/05-æ•°æ®è½¬æ¢"
parentChapter: "python-ai/pandas/README"
---
# æ•°æ®æ¸…æ´—

> æŒæ¡æ•°æ®æ¸…æ´—çš„æ ¸å¿ƒæŠ€èƒ½

## ğŸ“š å­¦ä¹ ç›®æ ‡

- æŒæ¡ç¼ºå¤±å€¼å¤„ç†
- å­¦ä¼šå¤„ç†é‡å¤æ•°æ®
- æŒæ¡æ•°æ®ç±»å‹è½¬æ¢
- å­¦ä¼šå­—ç¬¦ä¸²å¤„ç†
- æŒæ¡å¼‚å¸¸å€¼å¤„ç†

## 1. å¤„ç†ç¼ºå¤±å€¼

### 1.1 æ£€æµ‹ç¼ºå¤±å€¼

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    'A': [1, 2, np.nan, 4],
    'B': [5, np.nan, np.nan, 8],
    'C': [9, 10, 11, 12]
})

# æ£€æµ‹ç¼ºå¤±å€¼
print(df.isnull())
print(df.isna())  # åŒä¹‰

# ç»Ÿè®¡ç¼ºå¤±å€¼
print(df.isnull().sum())

# æ£€æµ‹ä»»ä½•ç¼ºå¤±å€¼
print(df.isnull().any())

# æ£€æµ‹å…¨éƒ¨ç¼ºå¤±
print(df.isnull().all())
```

### 1.2 åˆ é™¤ç¼ºå¤±å€¼

```python
# åˆ é™¤åŒ…å«ç¼ºå¤±å€¼çš„è¡Œ
df_dropped = df.dropna()

# åˆ é™¤å…¨ä¸ºç¼ºå¤±å€¼çš„è¡Œ
df_dropped = df.dropna(how='all')

# åˆ é™¤åŒ…å«ç¼ºå¤±å€¼çš„åˆ—
df_dropped = df.dropna(axis=1)

# ä¿ç•™è‡³å°‘æœ‰nä¸ªéç¼ºå¤±å€¼çš„è¡Œ
df_dropped = df.dropna(thresh=2)
```

### 1.3 å¡«å……ç¼ºå¤±å€¼

```python
# ç”¨æ ‡é‡å¡«å……
df_filled = df.fillna(0)

# ç”¨å‡å€¼å¡«å……
df['A'] = df['A'].fillna(df['A'].mean())

# ç”¨ä¸­ä½æ•°å¡«å……
df['B'] = df['B'].fillna(df['B'].median())

# å‰å‘å¡«å……
df_ffill = df.fillna(method='ffill')

# åå‘å¡«å……
df_bfill = df.fillna(method='bfill')

# ç”¨å­—å…¸å¡«å……ä¸åŒåˆ—
df_filled = df.fillna({'A': 0, 'B': df['B'].mean()})

# æ’å€¼å¡«å……
df['A'] = df['A'].interpolate()
```

## 2. å¤„ç†é‡å¤æ•°æ®

```python
df = pd.DataFrame({
    'name': ['Alice', 'Bob', 'Alice', 'Charlie'],
    'age': [25, 30, 25, 35]
})

# æ£€æµ‹é‡å¤è¡Œ
duplicates = df.duplicated()
print(duplicates)

# æŸ¥çœ‹é‡å¤è¡Œ
print(df[df.duplicated()])

# åˆ é™¤é‡å¤è¡Œ
df_unique = df.drop_duplicates()

# ä¿ç•™æœ€åä¸€ä¸ª
df_unique = df.drop_duplicates(keep='last')

# åŸºäºæŒ‡å®šåˆ—å»é‡
df_unique = df.drop_duplicates(subset=['name'])
```

## 3. æ•°æ®ç±»å‹è½¬æ¢

```python
df = pd.DataFrame({
    'A': ['1', '2', '3'],
    'B': ['4.5', '5.6', '6.7'],
    'C': ['2024-01-01', '2024-01-02', '2024-01-03']
})

# æŸ¥çœ‹æ•°æ®ç±»å‹
print(df.dtypes)

# è½¬æ¢ä¸ºæ•´æ•°
df['A'] = df['A'].astype(int)

# è½¬æ¢ä¸ºæµ®ç‚¹æ•°
df['B'] = df['B'].astype(float)

# è½¬æ¢ä¸ºæ—¥æœŸæ—¶é—´
df['C'] = pd.to_datetime(df['C'])

# è½¬æ¢ä¸ºåˆ†ç±»ç±»å‹
df['category'] = pd.Categorical(['A', 'B', 'A'])

# æ‰¹é‡è½¬æ¢
df = df.astype({'A': int, 'B': float})
```

## 4. å­—ç¬¦ä¸²å¤„ç†

```python
df = pd.DataFrame({
    'name': ['  Alice  ', 'bob', 'CHARLIE'],
    'email': ['alice@example.com', 'bob@test.com', 'charlie@demo.com']
})

# å»é™¤ç©ºæ ¼
df['name'] = df['name'].str.strip()

# è½¬æ¢å¤§å°å†™
df['name_upper'] = df['name'].str.upper()
df['name_lower'] = df['name'].str.lower()
df['name_title'] = df['name'].str.title()

# æ›¿æ¢
df['email'] = df['email'].str.replace('@', ' at ')

# åˆ†å‰²
df[['username', 'domain']] = df['email'].str.split('@', expand=True)

# åŒ…å«åˆ¤æ–­
mask = df['name'].str.contains('Alice')

# æå–
df['first_char'] = df['name'].str[0]

# é•¿åº¦
df['name_length'] = df['name'].str.len()
```

## 5. å¼‚å¸¸å€¼å¤„ç†

```python
import numpy as np

df = pd.DataFrame({
    'value': [10, 12, 11, 100, 13, 12, 11, -50, 14]
})

# ä½¿ç”¨IQRæ–¹æ³•
Q1 = df['value'].quantile(0.25)
Q3 = df['value'].quantile(0.75)
IQR = Q3 - Q1

lower_bound = Q1 - 1.5 * IQR
upper_bound = Q3 + 1.5 * IQR

# è¯†åˆ«å¼‚å¸¸å€¼
outliers = (df['value'] < lower_bound) | (df['value'] > upper_bound)
print('å¼‚å¸¸å€¼:\n', df[outliers])

# ç§»é™¤å¼‚å¸¸å€¼
df_clean = df[~outliers]

# æ›¿æ¢å¼‚å¸¸å€¼
df.loc[outliers, 'value'] = df['value'].median()

# ä½¿ç”¨Z-scoreæ–¹æ³•
from scipy import stats
z_scores = np.abs(stats.zscore(df['value']))
outliers = z_scores > 3
```

## 6. å®æˆ˜ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ¸…æ´—ç”¨æˆ·æ•°æ®

```python
# åŸå§‹æ•°æ®
users = pd.DataFrame({
    'user_id': [1, 2, 2, 3, 4],
    'name': ['  Alice  ', 'Bob', 'Bob', None, 'Charlie'],
    'age': ['25', '30', '30', 'unknown', '35'],
    'email': ['alice@test.com', 'bob@test.com', 'bob@test.com', 
              'invalid', 'charlie@test.com']
})

# 1. åˆ é™¤é‡å¤ç”¨æˆ·
users = users.drop_duplicates(subset=['user_id'])

# 2. å¤„ç†ç¼ºå¤±å€¼
users['name'] = users['name'].fillna('Unknown')

# 3. æ¸…æ´—å­—ç¬¦ä¸²
users['name'] = users['name'].str.strip().str.title()

# 4. å¤„ç†å¹´é¾„æ•°æ®
users['age'] = pd.to_numeric(users['age'], errors='coerce')
users['age'] = users['age'].fillna(users['age'].median())

# 5. éªŒè¯é‚®ç®±
valid_email = users['email'].str.contains('@', na=False)
users = users[valid_email]

print('æ¸…æ´—åæ•°æ®:\n', users)
```

### ç¤ºä¾‹2ï¼šæ¸…æ´—é”€å”®æ•°æ®

```python
sales = pd.DataFrame({
    'date': ['2024-01-01', '2024/01/02', 'invalid', '2024-01-04'],
    'product': ['A', 'B', 'A', None],
    'quantity': [10, -5, 15, 20],
    'price': [100, 150, 100, 200]
})

# 1. å¤„ç†æ—¥æœŸ
sales['date'] = pd.to_datetime(sales['date'], errors='coerce')
sales = sales.dropna(subset=['date'])

# 2. å¤„ç†äº§å“åç§°
sales['product'] = sales['product'].fillna('Unknown')

# 3. å¤„ç†è´Ÿæ•°æ•°é‡
sales = sales[sales['quantity'] > 0]

# 4. è®¡ç®—é”€å”®é¢
sales['revenue'] = sales['quantity'] * sales['price']

print('æ¸…æ´—åæ•°æ®:\n', sales)
```

## ç»ƒä¹ é¢˜

1. å¤„ç†åŒ…å«ç¼ºå¤±å€¼çš„æ•°æ®é›†
2. åˆ é™¤é‡å¤çš„å­¦ç”Ÿè®°å½•
3. æ¸…æ´—åŒ…å«æ ¼å¼ä¸ä¸€è‡´çš„æ—¥æœŸæ•°æ®
4. è¯†åˆ«å¹¶å¤„ç†å¼‚å¸¸å€¼

---

**ä¸‹ä¸€èŠ‚ï¼š** [æ•°æ®è½¬æ¢](05-æ•°æ®è½¬æ¢.md)
