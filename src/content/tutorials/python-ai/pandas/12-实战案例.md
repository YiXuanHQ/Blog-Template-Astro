---
title: 实战案例
prevChapter: "python-ai/pandas/11-数据可视化"
parentChapter: "python-ai/pandas/README"
---
# 实战案例

> 通过实战项目掌握Pandas

## 📚 学习目标

- 应用Pandas解决实际问题
- 掌握完整数据分析流程
- 学会综合运用所学知识

## 1. 销售数据分析

```python
import pandas as pd
import numpy as np

# 加载数据
sales = pd.read_csv('sales.csv')

# 数据清洗
sales['date'] = pd.to_datetime(sales['date'])
sales = sales.dropna()
sales = sales.drop_duplicates()

# 数据分析
monthly_sales = sales.groupby(sales['date'].dt.to_period('M')).agg({
    'amount': 'sum',
    'quantity': 'sum'
})

# 计算增长率
monthly_sales['growth'] = monthly_sales['amount'].pct_change()

# 可视化
monthly_sales['amount'].plot(figsize=(12, 6), title='Monthly Sales Trend')
```

## 2. 用户行为分析

```python
# 加载用户行为数据
users = pd.read_csv('user_behavior.csv')

# 活跃用户分析
daily_active = users.groupby('date')['user_id'].nunique()

# 留存率计算
def calculate_retention(df, days):
    first_day = df.groupby('user_id')['date'].min()
    return df[df['date'] == first_day + pd.Timedelta(days=days)].shape[0]

retention_7d = calculate_retention(users, 7)
```

## 3. 股票数据分析

```python
# 加载股票数据
stocks = pd.read_csv('stocks.csv', parse_dates=['date'])
stocks = stocks.set_index('date')

# 计算收益率
stocks['return'] = stocks['close'].pct_change()

# 移动平均
stocks['MA20'] = stocks['close'].rolling(window=20).mean()
stocks['MA60'] = stocks['close'].rolling(window=60).mean()

# 波动率
stocks['volatility'] = stocks['return'].rolling(window=20).std() * np.sqrt(252)

# 可视化
stocks[['close', 'MA20', 'MA60']].plot(figsize=(12, 6))
```

## 4. 文本数据处理

```python
# 加载评论数据
reviews = pd.read_csv('reviews.csv')

# 文本清洗
reviews['text'] = reviews['text'].str.lower()
reviews['text'] = reviews['text'].str.replace('[^a-zA-Z]', ' ')

# 提取关键词
reviews['word_count'] = reviews['text'].str.split().str.len()

# 情感分类
def classify_sentiment(text):
    positive_words = ['good', 'great', 'excellent']
    negative_words = ['bad', 'poor', 'terrible']
    
    if any(word in text.lower() for word in positive_words):
        return 'positive'
    elif any(word in text.lower() for word in negative_words):
        return 'negative'
    else:
        return 'neutral'

reviews['sentiment'] = reviews['text'].apply(classify_sentiment)

# 统计分析
sentiment_counts = reviews['sentiment'].value_counts()
```

## 5. 综合项目：电商数据分析

```python
# 1. 数据加载
orders = pd.read_csv('orders.csv')
customers = pd.read_csv('customers.csv')
products = pd.read_csv('products.csv')

# 2. 数据清洗
orders['order_date'] = pd.to_datetime(orders['order_date'])
orders = orders[orders['amount'] > 0]

# 3. 数据合并
data = orders.merge(customers, on='customer_id')
data = data.merge(products, on='product_id')

# 4. 特征工程
data['year_month'] = data['order_date'].dt.to_period('M')
data['day_of_week'] = data['order_date'].dt.dayofweek

# 5. 分析指标
# 销售趋势
sales_trend = data.groupby('year_month')['amount'].sum()

# 客户价值分析
customer_value = data.groupby('customer_id').agg({
    'order_id': 'count',      # 订单数
    'amount': 'sum',          # 总金额
    'order_date': lambda x: (x.max() - x.min()).days  # 活跃天数
})
customer_value.columns = ['order_count', 'total_amount', 'active_days']

# RFM分析
latest_date = data['order_date'].max()
rfm = data.groupby('customer_id').agg({
    'order_date': lambda x: (latest_date - x.max()).days,  # Recency
    'order_id': 'count',                                    # Frequency
    'amount': 'sum'                                         # Monetary
})
rfm.columns = ['recency', 'frequency', 'monetary']

# 客户分层
rfm['r_score'] = pd.qcut(rfm['recency'], 4, labels=[4, 3, 2, 1])
rfm['f_score'] = pd.qcut(rfm['frequency'].rank(method='first'), 4, labels=[1, 2, 3, 4])
rfm['m_score'] = pd.qcut(rfm['monetary'], 4, labels=[1, 2, 3, 4])
rfm['rfm_score'] = rfm['r_score'].astype(str) + rfm['f_score'].astype(str) + rfm['m_score'].astype(str)

# 6. 可视化
import matplotlib.pyplot as plt

fig, axes = plt.subplots(2, 2, figsize=(15, 10))

# 销售趋势
sales_trend.plot(ax=axes[0, 0], title='Sales Trend')

# 产品类别分布
data.groupby('category')['amount'].sum().plot(kind='pie', ax=axes[0, 1], title='Sales by Category')

# 客户价值分布
customer_value['total_amount'].hist(bins=50, ax=axes[1, 0])
axes[1, 0].set_title('Customer Value Distribution')

# RFM得分分布
rfm['rfm_score'].value_counts().head(10).plot(kind='bar', ax=axes[1, 1], title='Top 10 RFM Segments')

plt.tight_layout()
plt.savefig('ecommerce_analysis.png')

# 7. 生成报表
report = {
    '总销售额': data['amount'].sum(),
    '总订单数': data['order_id'].nunique(),
    '客户总数': data['customer_id'].nunique(),
    '平均客单价': data.groupby('order_id')['amount'].sum().mean(),
    '复购率': (customer_value['order_count'] > 1).sum() / len(customer_value)
}

print('\n=== 数据分析报表 ===')
for key, value in report.items():
    print(f'{key}: {value:,.2f}')
```

## 💡 总结

通过这些实战案例，你应该掌握了：

1. **完整的数据分析流程** - 从数据加载到结果输出
2. **数据清洗技巧** - 处理缺失值、异常值、重复数据
3. **特征工程** - 提取和构造有用的特征
4. **数据分析方法** - 分组、聚合、透视等
5. **可视化技巧** - 使用图表展示分析结果
6. **业务洞察** - 从数据中发现业务价值

## 练习项目

1. 分析Titanic数据集，预测生存率
2. 分析房价数据，找出影响因素
3. 分析电影评分数据，推荐系统
4. 分析天气数据，预测趋势

---

**恭喜完成 Pandas 教程！** 🎉

继续学习：[Matplotlib 数据可视化](../matplotlib/) 或 [机器学习基础](../ml-basics/)
