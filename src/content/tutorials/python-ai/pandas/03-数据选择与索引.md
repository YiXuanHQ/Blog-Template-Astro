---
title: æ•°æ®é€‰æ‹©ä¸ç´¢å¼•
prevChapter: "python-ai/pandas/02-æ•°æ®è¯»å–ä¸å†™å…¥"
nextChapter: "python-ai/pandas/04-æ•°æ®æ¸…æ´—"
parentChapter: "python-ai/pandas/README"
---
# æ•°æ®é€‰æ‹©ä¸ç´¢å¼•

> æŒæ¡Pandasçš„æ•°æ®é€‰æ‹©å’Œç´¢å¼•æŠ€å·§

## ğŸ“š å­¦ä¹ ç›®æ ‡

- æŒæ¡åˆ—é€‰æ‹©æ–¹æ³•
- ç†è§£locå’Œilocçš„åŒºåˆ«
- æŒæ¡å¸ƒå°”ç´¢å¼•
- å­¦ä¼šä½¿ç”¨queryæ–¹æ³•
- ç†è§£å¤šå±‚ç´¢å¼•

## 1. åˆ—é€‰æ‹©

```python
import pandas as pd

df = pd.DataFrame({
    'name': ['Alice', 'Bob', 'Charlie'],
    'age': [25, 30, 35],
    'city': ['NY', 'Paris', 'London'],
    'salary': [50000, 60000, 70000]
})

# å•åˆ—é€‰æ‹©ï¼ˆè¿”å›Seriesï¼‰
name_col = df['name']
print(type(name_col))  # Series

# å±æ€§è®¿é—®
age_col = df.age

# å¤šåˆ—é€‰æ‹©ï¼ˆè¿”å›DataFrameï¼‰
subset = df[['name', 'age']]
print(type(subset))  # DataFrame

# é€‰æ‹©æ‰€æœ‰åˆ—é™¤äº†æŸäº›åˆ—
cols = df.columns.drop(['city'])
subset = df[cols]
```

## 2. è¡Œé€‰æ‹©

```python
# åˆ‡ç‰‡é€‰æ‹©
first_two = df[0:2]
print(first_two)

# æ¡ä»¶é€‰æ‹©
young = df[df['age'] < 30]
print(young)

# å¤šæ¡ä»¶
high_salary = df[(df['age'] > 25) & (df['salary'] > 55000)]
print(high_salary)
```

## 3. loc - æ ‡ç­¾ç´¢å¼•

```python
df = pd.DataFrame({
    'A': [1, 2, 3, 4],
    'B': [5, 6, 7, 8],
    'C': [9, 10, 11, 12]
}, index=['row1', 'row2', 'row3', 'row4'])

# é€‰æ‹©å•è¡Œ
print(df.loc['row1'])

# é€‰æ‹©å¤šè¡Œ
print(df.loc[['row1', 'row3']])

# é€‰æ‹©è¡Œå’Œåˆ—
print(df.loc['row1', 'A'])
print(df.loc['row1':'row3', 'A':'B'])

# é€‰æ‹©æ‰€æœ‰è¡Œï¼Œéƒ¨åˆ†åˆ—
print(df.loc[:, ['A', 'C']])

# æ¡ä»¶é€‰æ‹©
print(df.loc[df['A'] > 2])

# èµ‹å€¼
df.loc['row1', 'A'] = 100
```

## 4. iloc - ä½ç½®ç´¢å¼•

```python
# é€‰æ‹©å•è¡Œ
print(df.iloc[0])

# é€‰æ‹©å¤šè¡Œ
print(df.iloc[[0, 2]])

# åˆ‡ç‰‡
print(df.iloc[0:2])

# é€‰æ‹©è¡Œå’Œåˆ—
print(df.iloc[0, 0])  # ç¬¬1è¡Œç¬¬1åˆ—
print(df.iloc[0:2, 0:2])  # å‰2è¡Œå‰2åˆ—

# é€‰æ‹©æ‰€æœ‰è¡Œï¼Œéƒ¨åˆ†åˆ—
print(df.iloc[:, [0, 2]])

# è´Ÿç´¢å¼•
print(df.iloc[-1])  # æœ€åä¸€è¡Œ
```

## 5. at å’Œ iat - å¿«é€Ÿæ ‡é‡è®¿é—®

```python
# at - æ ‡ç­¾è®¿é—®ï¼ˆæ›´å¿«ï¼‰
value = df.at['row1', 'A']

# iat - ä½ç½®è®¿é—®ï¼ˆæ›´å¿«ï¼‰
value = df.iat[0, 0]

# èµ‹å€¼
df.at['row1', 'A'] = 999
df.iat[0, 0] = 888
```

## 6. å¸ƒå°”ç´¢å¼•

```python
df = pd.DataFrame({
    'name': ['Alice', 'Bob', 'Charlie', 'David'],
    'age': [25, 30, 35, 40],
    'salary': [50000, 60000, 70000, 80000]
})

# å•æ¡ä»¶
young = df[df['age'] < 35]

# å¤šæ¡ä»¶ï¼ˆä¸ï¼‰
result = df[(df['age'] > 25) & (df['salary'] > 55000)]

# å¤šæ¡ä»¶ï¼ˆæˆ–ï¼‰
result = df[(df['age'] < 30) | (df['salary'] > 70000)]

# å–å
result = df[~(df['age'] < 30)]

# isin æ–¹æ³•
names = ['Alice', 'Charlie']
result = df[df['name'].isin(names)]

# å­—ç¬¦ä¸²æ–¹æ³•
result = df[df['name'].str.startswith('A')]
```

## 7. query æ–¹æ³•

```python
# ç®€æ´çš„æŸ¥è¯¢è¯­æ³•
result = df.query('age > 30')

# å¤šæ¡ä»¶
result = df.query('age > 25 and salary > 55000')

# ä½¿ç”¨å˜é‡
min_age = 30
result = df.query('age > @min_age')

# å­—ç¬¦ä¸²åŒ¹é…
result = df.query('name == "Alice"')

# in æ“ä½œ
result = df.query('age in [25, 35]')
```

## 8. å¤šå±‚ç´¢å¼•

### 8.1 åˆ›å»ºå¤šå±‚ç´¢å¼•

```python
# ä»å…ƒç»„åˆ›å»º
index = pd.MultiIndex.from_tuples([
    ('A', 1), ('A', 2), ('B', 1), ('B', 2)
], names=['letter', 'number'])

df = pd.DataFrame({
    'value': [10, 20, 30, 40]
}, index=index)

print(df)
```

### 8.2 å¤šå±‚ç´¢å¼•é€‰æ‹©

```python
# é€‰æ‹©ç¬¬ä¸€å±‚
print(df.loc['A'])

# é€‰æ‹©å¤šå±‚
print(df.loc[('A', 1)])

# ä½¿ç”¨slice
print(df.loc[('A', slice(None)), :])

# xs æ–¹æ³•
print(df.xs('A', level='letter'))
print(df.xs(1, level='number'))
```

### 8.3 å¤šå±‚ç´¢å¼•æ“ä½œ

```python
# é‡ç½®ç´¢å¼•
df_reset = df.reset_index()

# è®¾ç½®ç´¢å¼•
df_indexed = df_reset.set_index(['letter', 'number'])

# äº¤æ¢å±‚çº§
df_swapped = df.swaplevel()

# æ’åº
df_sorted = df.sort_index()
```

## 9. å®æˆ˜ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ•°æ®ç­›é€‰

```python
# å­¦ç”Ÿæˆç»©æ•°æ®
scores = pd.DataFrame({
    'name': ['Alice', 'Bob', 'Charlie', 'David', 'Eve'],
    'math': [85, 92, 78, 95, 88],
    'english': [90, 85, 88, 92, 95],
    'science': [88, 90, 85, 98, 92]
})

# æ‰¾å‡ºæ•°å­¦æˆç»©å¤§äº90çš„å­¦ç”Ÿ
high_math = scores[scores['math'] > 90]
print('æ•°å­¦æˆç»©>90:\n', high_math)

# æ‰¾å‡ºæ•°å­¦å’Œè‹±è¯­éƒ½å¤§äº85çš„å­¦ç”Ÿ
good_students = scores[(scores['math'] > 85) & (scores['english'] > 85)]
print('\næ•°å­¦å’Œè‹±è¯­éƒ½>85:\n', good_students)

# æ‰¾å‡ºä»»ä¸€ç§‘ç›®å¤§äº90çš„å­¦ç”Ÿ
excellent = scores[(scores['math'] > 90) | 
                   (scores['english'] > 90) | 
                   (scores['science'] > 90)]
print('\nä»»ä¸€ç§‘ç›®>90:\n', excellent)
```

### ç¤ºä¾‹2ï¼šæ¡ä»¶èµ‹å€¼

```python
# æ ¹æ®æ¡ä»¶ä¿®æ”¹æ•°æ®
df = pd.DataFrame({
    'score': [85, 92, 78, 95, 88]
})

# å°†å¤§äº90çš„åˆ†æ•°è®¾ä¸ºä¼˜ç§€
df.loc[df['score'] > 90, 'grade'] = 'A'
df.loc[(df['score'] >= 80) & (df['score'] <= 90), 'grade'] = 'B'
df.loc[df['score'] < 80, 'grade'] = 'C'

print(df)
```

### ç¤ºä¾‹3ï¼šå¤æ‚ç´¢å¼•

```python
# é”€å”®æ•°æ®
sales = pd.DataFrame({
    'date': pd.date_range('2024-01-01', periods=10),
    'product': ['A', 'B', 'A', 'B', 'A', 'B', 'A', 'B', 'A', 'B'],
    'quantity': [10, 15, 12, 18, 14, 20, 16, 22, 18, 25],
    'price': [100, 150, 100, 150, 100, 150, 100, 150, 100, 150]
})

# è®¾ç½®å¤šå±‚ç´¢å¼•
sales_indexed = sales.set_index(['date', 'product'])

# æŸ¥è¯¢ç‰¹å®šæ—¥æœŸçš„äº§å“A
result = sales_indexed.xs('A', level='product')
print(result.head())

# æŸ¥è¯¢ç‰¹å®šæ—¥æœŸèŒƒå›´
result = sales_indexed.loc['2024-01-01':'2024-01-05']
print(result)
```

## 10. æ€§èƒ½æŠ€å·§

```python
import time

df = pd.DataFrame({
    'A': range(100000),
    'B': range(100000)
})

# ä½¿ç”¨locï¼ˆæ¨èï¼‰
start = time.time()
result = df.loc[df['A'] > 50000]
print(f'locè€—æ—¶: {time.time() - start:.6f}ç§’')

# ä½¿ç”¨å¸ƒå°”ç´¢å¼•ï¼ˆå¿«ï¼‰
start = time.time()
result = df[df['A'] > 50000]
print(f'å¸ƒå°”ç´¢å¼•è€—æ—¶: {time.time() - start:.6f}ç§’')

# ä½¿ç”¨queryï¼ˆæ›´å¿«ï¼‰
start = time.time()
result = df.query('A > 50000')
print(f'queryè€—æ—¶: {time.time() - start:.6f}ç§’')
```

## ç»ƒä¹ é¢˜

1. é€‰æ‹©DataFrameçš„ç¬¬2åˆ°ç¬¬5è¡Œ
2. é€‰æ‹©å¹´é¾„å¤§äº30ä¸”å·¥èµ„å¤§äº60000çš„å‘˜å·¥
3. ä½¿ç”¨queryæ–¹æ³•ç­›é€‰æ•°æ®
4. åˆ›å»ºå¤šå±‚ç´¢å¼•å¹¶è¿›è¡Œé€‰æ‹©

---

**ä¸‹ä¸€èŠ‚ï¼š** [æ•°æ®æ¸…æ´—](04-æ•°æ®æ¸…æ´—.md)
