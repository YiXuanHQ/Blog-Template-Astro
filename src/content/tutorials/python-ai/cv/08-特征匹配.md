---
title: ç‰¹å¾åŒ¹é…
prevChapter: "python-ai/cv/07-å›¾åƒåˆ†å‰²"
nextChapter: "python-ai/cv/09-CNNåŸºç¡€"
parentChapter: "python-ai/cv/README"
---
# ç‰¹å¾åŒ¹é…

> æŒæ¡ç‰¹å¾åŒ¹é…å’Œå›¾åƒé…å‡†

## ğŸ“š å­¦ä¹ ç›®æ ‡

- ç†è§£ç‰¹å¾åŒ¹é…
- æŒæ¡BFåŒ¹é…
- å­¦ä¼šFLANNåŒ¹é…
- äº†è§£å›¾åƒæ‹¼æ¥

## 1. æš´åŠ›åŒ¹é…

```python
import cv2

# è¯»å–å›¾åƒ
img1 = cv2.imread('image1.jpg', 0)
img2 = cv2.imread('image2.jpg', 0)

# SIFTç‰¹å¾
sift = cv2.SIFT_create()
kp1, des1 = sift.detectAndCompute(img1, None)
kp2, des2 = sift.detectAndCompute(img2, None)

# BFåŒ¹é…å™¨
bf = cv2.BFMatcher()
matches = bf.knnMatch(des1, des2, k=2)

# ç­›é€‰å¥½çš„åŒ¹é…
good = []
for m, n in matches:
    if m.distance < 0.75 * n.distance:
        good.append([m])

# ç»˜åˆ¶åŒ¹é…
img_matches = cv2.drawMatchesKnn(img1, kp1, img2, kp2, good, None,
                                 flags=cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS)
cv2.imshow('Matches', img_matches)
cv2.waitKey(0)
```

## 2. FLANNåŒ¹é…

```python
# FLANNå‚æ•°
FLANN_INDEX_KDTREE = 1
index_params = dict(algorithm=FLANN_INDEX_KDTREE, trees=5)
search_params = dict(checks=50)

# FLANNåŒ¹é…å™¨
flann = cv2.FlannBasedMatcher(index_params, search_params)
matches = flann.knnMatch(des1, des2, k=2)

# ç­›é€‰
good = []
for m, n in matches:
    if m.distance < 0.7 * n.distance:
        good.append(m)
```

## 3. å•åº”æ€§å˜æ¢

```python
import numpy as np

if len(good) > 10:
    src_pts = np.float32([kp1[m.queryIdx].pt for m in good]).reshape(-1, 1, 2)
    dst_pts = np.float32([kp2[m.trainIdx].pt for m in good]).reshape(-1, 1, 2)
    
    # è®¡ç®—å•åº”æ€§çŸ©é˜µ
    M, mask = cv2.findHomography(src_pts, dst_pts, cv2.RANSAC, 5.0)
    
    # é€è§†å˜æ¢
    h, w = img1.shape
    pts = np.float32([[0, 0], [0, h-1], [w-1, h-1], [w-1, 0]]).reshape(-1, 1, 2)
    dst = cv2.perspectiveTransform(pts, M)
    
    # ç»˜åˆ¶è¾¹ç•Œ
    img2_marked = cv2.polylines(img2, [np.int32(dst)], True, 255, 3)
```

## 4. å›¾åƒæ‹¼æ¥

```python
# ä½¿ç”¨Stitcher
stitcher = cv2.Stitcher_create()
status, pano = stitcher.stitch([img1, img2])

if status == cv2.Stitcher_OK:
    cv2.imshow('Panorama', pano)
    cv2.waitKey(0)
else:
    print("æ‹¼æ¥å¤±è´¥")
```

---

**ä¸‹ä¸€èŠ‚ï¼š** [CNNåŸºç¡€](09-CNNåŸºç¡€.md)
