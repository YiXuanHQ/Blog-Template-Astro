---
import type { HTMLAttributes } from 'astro/types';

interface Props extends HTMLAttributes<'a'> {
	icon?: any; // SVG 组件
}

const { href, icon: Icon, class: className, ...props } = Astro.props;
// 规范化路径：移除尾部斜杠，统一处理
const normalizePath = (path: string) => {
	if (!path) return '/';
	const cleaned = path.replace(import.meta.env.BASE_URL, '').replace(/\/$/, '');
	return cleaned === '' ? '/' : cleaned;
};

const pathname = normalizePath(Astro.url.pathname);
const normalizedHref = normalizePath(href);

// 匹配逻辑：
// 1. 完全匹配
// 2. 首页特殊处理
// 3. 子路径匹配（如 /tutorials/xxx/ 应该高亮 /tutorials/）
let isActive = false;

if (normalizedHref === '/' && pathname === '/') {
	isActive = true;
} else if (normalizedHref === '/') {
	isActive = false; // 首页链接只在首页时激活
} else {
	// 对于其他链接，检查是否完全匹配或路径以该链接开头
	isActive = pathname === normalizedHref || pathname.startsWith(normalizedHref + '/');
}
---

<a href={href} class:list={[className, { active: isActive }]} {...props}>
	{Icon && (
		<span class="link-icon">
			<Icon />
		</span>
	)}
	<slot />
</a>
<style>
	a {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		gap: 0.4rem;
		text-decoration: none;
		line-height: 1;
	}
	.link-icon {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		flex-shrink: 0;
		width: 1em;
		height: 1em;
		font-size: 0.95rem;
		line-height: 1;
		flex-shrink: 0;
	}
	.link-icon svg {
		width: 100%;
		height: 100%;
		display: block;
		vertical-align: 0;
	}
	/* 激活状态样式由 Header.astro 统一管理 */
</style>
